# æˆæœ¬é…ç½®ç®¡ç†

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**
- [tradingagents/config/config_manager.py](file://tradingagents/config/config_manager.py)
- [web/modules/config_management.py](file://web/modules/config_management.py)
- [examples/config_management_demo.py](file://examples/config_management_demo.py)
- [examples/token_tracking_demo.py](file://examples/token_tracking_demo.py)
- [tests/test_config_management.py](file://tests/test_config_management.py)
- [tradingagents/utils/logging_manager.py](file://tradingagents/utils/logging_manager.py)
- [tradingagents/config/env_utils.py](file://tradingagents/config/env_utils.py)
- [config/logging.toml](file://config/logging.toml)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ](#ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ)
3. [ConfigManageræ ¸å¿ƒç»„ä»¶](#configmanageræ ¸å¿ƒç»„ä»¶)
4. [å®šä»·é…ç½®ç®¡ç†](#å®šä»·é…ç½®ç®¡ç†)
5. [è®¾ç½®é…ç½®ç®¡ç†](#è®¾ç½®é…ç½®ç®¡ç†)
6. [æˆæœ¬è·Ÿè¸ªæœºåˆ¶](#æˆæœ¬è·Ÿè¸ªæœºåˆ¶)
7. [ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§](#ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§)
8. [æ“ä½œæŒ‡å—](#æ“ä½œæŒ‡å—)
9. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
10. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

## ç®€ä»‹

TradingAgents-CNçš„æˆæœ¬é…ç½®ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªå…¨é¢çš„è§£å†³æ–¹æ¡ˆï¼Œç”¨äºç®¡ç†LLMæä¾›å•†çš„è´¹ç‡é…ç½®ã€æˆæœ¬è·Ÿè¸ªå’Œé¢„ç®—æ§åˆ¶ã€‚è¯¥ç³»ç»Ÿé€šè¿‡ConfigManagerç±»æä¾›ç»Ÿä¸€çš„é…ç½®ç®¡ç†æ¥å£ï¼Œæ”¯æŒå®æ—¶ä¿®æ”¹å®šä»·é…ç½®ï¼Œå¹¶å…·å¤‡æ™ºèƒ½çš„æˆæœ¬é¢„è­¦æœºåˆ¶ã€‚

### æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

- **åŠ¨æ€å®šä»·é…ç½®**ï¼šæ”¯æŒè¿è¡Œæ—¶ä¿®æ”¹å„LLMæä¾›å•†çš„è´¹ç‡è®¾ç½®
- **å¤šè´§å¸æ”¯æŒ**ï¼šå†…ç½®CNYã€USDã€EURç­‰å¤šç§è´§å¸å•ä½
- **æ™ºèƒ½æˆæœ¬è·Ÿè¸ª**ï¼šè‡ªåŠ¨è®°å½•Tokenä½¿ç”¨é‡å’Œè®¡ç®—æˆæœ¬
- **æˆæœ¬é¢„è­¦æœºåˆ¶**ï¼šåŸºäºé˜ˆå€¼çš„æˆæœ¬è­¦å‘Šç³»ç»Ÿ
- **ç¯å¢ƒå˜é‡é›†æˆ**ï¼šçµæ´»çš„ç¯å¢ƒå˜é‡é…ç½®ä¼˜å…ˆçº§
- **Webç•Œé¢ç®¡ç†**ï¼šç›´è§‚çš„å›¾å½¢åŒ–é…ç½®ç®¡ç†ç•Œé¢

## ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

```mermaid
graph TB
subgraph "é…ç½®ç®¡ç†å±‚"
CM[ConfigManager]
TC[TokenTracker]
EU[EnvUtils]
end
subgraph "é…ç½®æ–‡ä»¶"
MF[models.json]
PF[pricing.json]
UF[usage.json]
SF[settings.json]
end
subgraph "å¤–éƒ¨é…ç½®"
ENV[.envæ–‡ä»¶]
LOG[logging.toml]
end
subgraph "å­˜å‚¨å±‚"
FS[æ–‡ä»¶ç³»ç»Ÿ]
MDB[MongoDB]
end
subgraph "ç”¨æˆ·ç•Œé¢"
WEB[Webç®¡ç†ç•Œé¢]
CLI[å‘½ä»¤è¡Œç•Œé¢]
end
CM --> MF
CM --> PF
CM --> UF
CM --> SF
CM --> ENV
CM --> MDB
TC --> CM
WEB --> CM
CLI --> CM
FS --> MF
FS --> PF
FS --> UF
FS --> SF
```

**å›¾è¡¨æ¥æº**
- [tradingagents/config/config_manager.py](file://tradingagents/config/config_manager.py#L1-L50)
- [web/modules/config_management.py](file://web/modules/config_management.py#L1-L30)

## ConfigManageræ ¸å¿ƒç»„ä»¶

ConfigManageræ˜¯æ•´ä¸ªæˆæœ¬é…ç½®ç®¡ç†ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£åè°ƒå„ç§é…ç½®æ–‡ä»¶çš„åŠ è½½ã€ä¿å­˜å’Œç®¡ç†ã€‚

### ç±»ç»“æ„è®¾è®¡

```mermaid
classDiagram
class ConfigManager {
+Path config_dir
+Path models_file
+Path pricing_file
+Path usage_file
+Path settings_file
+MongoDBStorage mongodb_storage
+__init__(config_dir)
+load_models() ModelConfig[]
+save_models(models) void
+load_pricing() PricingConfig[]
+save_pricing(pricing) void
+load_settings() Dict
+save_settings(settings) void
+calculate_cost(provider, model, input_tokens, output_tokens) float
+add_usage_record(...) UsageRecord
+get_usage_statistics(days) Dict
+get_enabled_models() ModelConfig[]
+get_model_by_name(provider, model_name) ModelConfig
}
class ModelConfig {
+str provider
+str model_name
+str api_key
+str base_url
+int max_tokens
+float temperature
+bool enabled
}
class PricingConfig {
+str provider
+str model_name
+float input_price_per_1k
+float output_price_per_1k
+str currency
}
class UsageRecord {
+str timestamp
+str provider
+str model_name
+int input_tokens
+int output_tokens
+float cost
+str session_id
+str analysis_type
}
class TokenTracker {
+ConfigManager config_manager
+track_usage(...) UsageRecord
+get_session_cost(session_id) float
+estimate_cost(...) float
-_check_cost_alert(cost) void
}
ConfigManager --> ModelConfig : manages
ConfigManager --> PricingConfig : manages
ConfigManager --> UsageRecord : tracks
TokenTracker --> ConfigManager : uses
```

**å›¾è¡¨æ¥æº**
- [tradingagents/config/config_manager.py](file://tradingagents/config/config_manager.py#L25-L85)

### åˆå§‹åŒ–æµç¨‹

ConfigManageråœ¨åˆå§‹åŒ–æ—¶ä¼šæ‰§è¡Œä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š

1. **ç›®å½•åˆå§‹åŒ–**ï¼šåˆ›å»ºé…ç½®ç›®å½•ç»“æ„
2. **æ–‡ä»¶æ£€æŸ¥**ï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
3. **é»˜è®¤é…ç½®**ï¼šä¸ºç¼ºå¤±çš„é…ç½®æ–‡ä»¶åˆ›å»ºé»˜è®¤å†…å®¹
4. **ç¯å¢ƒå˜é‡åŠ è½½**ï¼šä».envæ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡
5. **MongoDBè¿æ¥**ï¼šå°è¯•å»ºç«‹MongoDBå­˜å‚¨è¿æ¥

**ç« èŠ‚æ¥æº**
- [tradingagents/config/config_manager.py](file://tradingagents/config/config_manager.py#L60-L120)

## å®šä»·é…ç½®ç®¡ç†

### pricing.jsonæ–‡ä»¶ç»“æ„

pricing.jsonæ–‡ä»¶å­˜å‚¨äº†æ‰€æœ‰LLMæä¾›å•†çš„è´¹ç‡é…ç½®ï¼Œé‡‡ç”¨æ ‡å‡†åŒ–çš„æ•°æ®ç»“æ„ï¼š

| å­—æ®µ | ç±»å‹ | æè¿° | ç¤ºä¾‹å€¼ |
|------|------|------|--------|
| provider | string | ä¾›åº”å•†åç§° | "dashscope", "openai", "deepseek" |
| model_name | string | æ¨¡å‹åç§° | "qwen-turbo", "gpt-4", "deepseek-chat" |
| input_price_per_1k | float | æ¯1000ä¸ªè¾“å…¥tokençš„ä»·æ ¼ | 0.002, 0.03, 0.0014 |
| output_price_per_1k | float | æ¯1000ä¸ªè¾“å‡ºtokençš„ä»·æ ¼ | 0.006, 0.06, 0.0028 |
| currency | string | è´§å¸å•ä½ | "CNY", "USD", "EUR" |

### é»˜è®¤å®šä»·é…ç½®

ç³»ç»Ÿé¢„é…ç½®äº†ä¸»æµLLMæä¾›å•†çš„è´¹ç‡ï¼š

#### é˜¿é‡Œç™¾ç‚¼ï¼ˆDashScopeï¼‰å®šä»·
- **qwen-turbo**: è¾“å…¥Â¥0.002/1K, è¾“å‡ºÂ¥0.006/1K (CNY)
- **qwen-plus-latest**: è¾“å…¥Â¥0.004/1K, è¾“å‡ºÂ¥0.012/1K (CNY)
- **qwen-max**: è¾“å…¥Â¥0.02/1K, è¾“å‡ºÂ¥0.06/1K (CNY)

#### DeepSeekå®šä»·
- **deepseek-chat**: è¾“å…¥Â¥0.0014/1K, è¾“å‡ºÂ¥0.0028/1K (CNY)
- **deepseek-coder**: è¾“å…¥Â¥0.0014/1K, è¾“å‡ºÂ¥0.0028/1K (CNY)

#### OpenAIå®šä»·
- **gpt-3.5-turbo**: è¾“å…¥$0.0015/1K, è¾“å‡º$0.002/1K (USD)
- **gpt-4**: è¾“å…¥$0.03/1K, è¾“å‡º$0.06/1K (USD)
- **gpt-4-turbo**: è¾“å…¥$0.01/1K, è¾“å‡º$0.03/1K (USD)

#### Google Geminiå®šä»·
- **gemini-2.5-pro**: è¾“å…¥$0.00025/1K, è¾“å‡º$0.0005/1K (USD)
- **gemini-pro**: è¾“å…¥$0.00025/1K, è¾“å‡º$0.0005/1K (USD)

### åŠ¨æ€å®šä»·ä¿®æ”¹

ç³»ç»Ÿæ”¯æŒé€šè¿‡å¤šç§æ–¹å¼ä¿®æ”¹å®šä»·é…ç½®ï¼š

#### é€šè¿‡Webç•Œé¢ä¿®æ”¹
```mermaid
sequenceDiagram
participant User as ç”¨æˆ·
participant Web as Webç•Œé¢
participant CM as ConfigManager
participant File as pricing.json
User->>Web : é€‰æ‹©ç¼–è¾‘å®šä»·
Web->>CM : load_pricing()
CM->>File : è¯»å–pricing.json
File-->>CM : è¿”å›å®šä»·æ•°æ®
CM-->>Web : è¿”å›å®šä»·é…ç½®
Web-->>User : æ˜¾ç¤ºå½“å‰å®šä»·
User->>Web : ä¿®æ”¹ä»·æ ¼å’Œè´§å¸
Web->>CM : save_pricing(updated_configs)
CM->>File : å†™å…¥æ›´æ–°çš„å®šä»·
File-->>CM : ç¡®è®¤ä¿å­˜
CM-->>Web : ä¿å­˜æˆåŠŸ
Web-->>User : æ˜¾ç¤ºä¿å­˜æˆåŠŸæ¶ˆæ¯
```

**å›¾è¡¨æ¥æº**
- [web/modules/config_management.py](file://web/modules/config_management.py#L179-L248)

#### é€šè¿‡å‘½ä»¤è¡Œä¿®æ”¹
```python
# åŠ è½½å½“å‰å®šä»·é…ç½®
pricing_configs = config_manager.load_pricing()

# æŸ¥æ‰¾å¹¶æ›´æ–°DeepSeekå®šä»·
for pricing in pricing_configs:
    if pricing.provider == "deepseek" and pricing.model_name == "deepseek-chat":
        pricing.input_price_per_1k = 0.0015  # æ›´æ–°è¾“å…¥ä»·æ ¼
        pricing.output_price_per_1k = 0.0030  # æ›´æ–°è¾“å‡ºä»·æ ¼
        break

# ä¿å­˜æ›´æ–°çš„é…ç½®
config_manager.save_pricing(pricing_configs)
```

**ç« èŠ‚æ¥æº**
- [web/modules/config_management.py](file://web/modules/config_management.py#L216-L248)
- [examples/config_management_demo.py](file://examples/config_management_demo.py#L203-L218)

### æˆæœ¬è®¡ç®—ç®—æ³•

ç³»ç»Ÿä½¿ç”¨æ ‡å‡†åŒ–çš„æˆæœ¬è®¡ç®—å…¬å¼ï¼š

```
æ€»æˆæœ¬ = (è¾“å…¥Tokenæ•° Ã· 1000) Ã— è¾“å…¥å•ä»· + (è¾“å‡ºTokenæ•° Ã· 1000) Ã— è¾“å‡ºå•ä»·
```

è¯¥ç®—æ³•æ”¯æŒä¸åŒè´§å¸å•ä½çš„æ··åˆè®¡ç®—ï¼Œå¹¶åœ¨æ‰¾ä¸åˆ°åŒ¹é…é…ç½®æ—¶è¿”å›0æˆæœ¬ã€‚

**ç« èŠ‚æ¥æº**
- [tradingagents/config/config_manager.py](file://tradingagents/config/config_manager.py#L380-L400)

## è®¾ç½®é…ç½®ç®¡ç†

### settings.jsoné…ç½®é¡¹

settings.jsonæ–‡ä»¶åŒ…å«äº†ç³»ç»Ÿè¿è¡Œçš„å„ç§è®¾ç½®å‚æ•°ï¼š

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|--------|------|--------|------|
| default_provider | string | "dashscope" | é»˜è®¤ä½¿ç”¨çš„LLMæä¾›å•† |
| default_model | string | "qwen-turbo" | é»˜è®¤ä½¿ç”¨çš„æ¨¡å‹ |
| enable_cost_tracking | boolean | true | æ˜¯å¦å¯ç”¨æˆæœ¬è·Ÿè¸ª |
| cost_alert_threshold | float | 100.0 | æˆæœ¬è­¦å‘Šé˜ˆå€¼ï¼ˆäººæ°‘å¸ï¼‰ |
| currency_preference | string | "CNY" | è´§å¸åå¥½è®¾ç½® |
| auto_save_usage | boolean | true | æ˜¯å¦è‡ªåŠ¨ä¿å­˜ä½¿ç”¨è®°å½• |
| max_usage_records | integer | 10000 | æœ€å¤§ä½¿ç”¨è®°å½•æ•°é‡ |
| data_dir | string | "~/.tradingagents/data" | æ•°æ®ç›®å½•è·¯å¾„ |
| cache_dir | string | "~/.tradingagents/cache" | ç¼“å­˜ç›®å½•è·¯å¾„ |
| results_dir | string | "~/.tradingagents/results" | ç»“æœç›®å½•è·¯å¾„ |

### æˆæœ¬è·Ÿè¸ªæ§åˆ¶

#### enable_cost_trackingè®¾ç½®
- **true**ï¼šå¯ç”¨å®Œæ•´çš„æˆæœ¬è·Ÿè¸ªåŠŸèƒ½
- **false**ï¼šç¦ç”¨æˆæœ¬è·Ÿè¸ªï¼Œæé«˜æ€§èƒ½ä½†æ— æ³•ç›‘æ§æˆæœ¬

#### cost_alert_thresholdè®¾ç½®
ç³»ç»Ÿä¼šåœ¨æ¯æ—¥æˆæœ¬è¾¾åˆ°é˜ˆå€¼æ—¶è§¦å‘è­¦å‘Šï¼š

```mermaid
flowchart TD
Start([å¼€å§‹æˆæœ¬æ£€æŸ¥]) --> LoadSettings["åŠ è½½è®¾ç½®é…ç½®"]
LoadSettings --> CheckEnabled{"æˆæœ¬è·Ÿè¸ªå¯ç”¨?"}
CheckEnabled --> |å¦| Skip[è·³è¿‡æ£€æŸ¥]
CheckEnabled --> |æ˜¯| CalcCost["è®¡ç®—ä»Šæ—¥æ€»æˆæœ¬"]
CalcCost --> CompareThreshold{"æ€»æˆæœ¬ â‰¥ é˜ˆå€¼?"}
CompareThreshold --> |å¦| Continue[ç»§ç»­ç›‘æ§]
CompareThreshold --> |æ˜¯| LogWarning["è®°å½•æˆæœ¬è­¦å‘Š"]
LogWarning --> SendAlert["å‘é€è­¦å‘Šé€šçŸ¥"]
SendAlert --> End([ç»“æŸ])
Continue --> End
Skip --> End
```

**å›¾è¡¨æ¥æº**
- [tradingagents/config/config_manager.py](file://tradingagents/config/config_manager.py#L680-L700)

### currency_preferenceé…ç½®

currency_preferenceè®¾ç½®å†³å®šäº†æˆæœ¬æ˜¾ç¤ºçš„è´§å¸åå¥½ï¼š

- **"CNY"**ï¼šæ˜¾ç¤ºäººæ°‘å¸æˆæœ¬ï¼ˆÂ¥ï¼‰
- **"USD"**ï¼šæ˜¾ç¤ºç¾å…ƒæˆæœ¬ï¼ˆ$ï¼‰
- **"EUR"**ï¼šæ˜¾ç¤ºæ¬§å…ƒæˆæœ¬ï¼ˆâ‚¬ï¼‰

ç³»ç»Ÿä¼šæ ¹æ®æ­¤è®¾ç½®è‡ªåŠ¨æ ¼å¼åŒ–æˆæœ¬æ˜¾ç¤ºï¼Œæ— éœ€æ‰‹åŠ¨è½¬æ¢ã€‚

**ç« èŠ‚æ¥æº**
- [tradingagents/config/config_manager.py](file://tradingagents/config/config_manager.py#L255-L275)

## æˆæœ¬è·Ÿè¸ªæœºåˆ¶

### TokenTrackerç»„ä»¶

TokenTrackeræ˜¯ä¸“é—¨è´Ÿè´£Tokenä½¿ç”¨è·Ÿè¸ªçš„ç»„ä»¶ï¼Œæä¾›ç»†ç²’åº¦çš„æˆæœ¬ç›‘æ§ï¼š

```mermaid
classDiagram
class TokenTracker {
+ConfigManager config_manager
+track_usage(provider, model, input_tokens, output_tokens, session_id, analysis_type) UsageRecord
+get_session_cost(session_id) float
+estimate_cost(provider, model, estimated_input_tokens, estimated_output_tokens) float
-_check_cost_alert(current_cost) void
}
class UsageRecord {
+str timestamp
+str provider
+str model_name
+int input_tokens
+int output_tokens
+float cost
+str session_id
+str analysis_type
}
TokenTracker --> UsageRecord : creates
TokenTracker --> ConfigManager : uses
```

**å›¾è¡¨æ¥æº**
- [tradingagents/config/config_manager.py](file://tradingagents/config/config_manager.py#L650-L680)

### ä½¿ç”¨è®°å½•æµç¨‹

```mermaid
sequenceDiagram
participant App as åº”ç”¨ç¨‹åº
participant TT as TokenTracker
participant CM as ConfigManager
participant Storage as å­˜å‚¨ç³»ç»Ÿ
App->>TT : track_usage(provider, model, tokens...)
TT->>CM : load_settings()
CM-->>TT : è¿”å›è®¾ç½®
TT->>CM : calculate_cost(...)
CM-->>TT : è¿”å›æˆæœ¬
TT->>CM : add_usage_record(...)
CM->>Storage : ä¿å­˜ä½¿ç”¨è®°å½•
Storage-->>CM : ç¡®è®¤ä¿å­˜
CM-->>TT : è¿”å›UsageRecord
TT->>TT : _check_cost_alert(cost)
alt æˆæœ¬è¶…è¿‡é˜ˆå€¼
TT->>App : è®°å½•æˆæœ¬è­¦å‘Š
end
TT-->>App : è¿”å›UsageRecord
```

**å›¾è¡¨æ¥æº**
- [tradingagents/config/config_manager.py](file://tradingagents/config/config_manager.py#L650-L680)

### ä½¿ç”¨ç»Ÿè®¡åŠŸèƒ½

ç³»ç»Ÿæä¾›ä¸°å¯Œçš„ä½¿ç”¨ç»Ÿè®¡åŠŸèƒ½ï¼š

#### ç»Ÿè®¡ç»´åº¦
- **æ—¶é—´èŒƒå›´**ï¼šæ”¯æŒ7å¤©ã€30å¤©ã€90å¤©ã€365å¤©ç»Ÿè®¡
- **æŒ‰ä¾›åº”å•†ç»Ÿè®¡**ï¼šåˆ†ä¾›åº”å•†æ±‡æ€»æˆæœ¬å’Œä½¿ç”¨æƒ…å†µ
- **Tokenç»Ÿè®¡**ï¼šè¾“å…¥Tokenå’Œè¾“å‡ºTokençš„æ€»é‡
- **è¯·æ±‚ç»Ÿè®¡**ï¼šæ€»è¯·æ±‚æ•°å’Œå¹³å‡æˆæœ¬

#### ç»Ÿè®¡æ•°æ®ç»“æ„
```json
{
    "period_days": 30,
    "total_cost": 125.75,
    "total_input_tokens": 150000,
    "total_output_tokens": 75000,
    "total_requests": 150,
    "provider_stats": {
        "dashscope": {
            "cost": 85.25,
            "input_tokens": 100000,
            "output_tokens": 50000,
            "requests": 100
        },
        "openai": {
            "cost": 40.50,
            "input_tokens": 50000,
            "output_tokens": 25000,
            "requests": 50
        }
    }
}
```

**ç« èŠ‚æ¥æº**
- [tradingagents/config/config_manager.py](file://tradingagents/config/config_manager.py#L550-L620)

## ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§

### é…ç½®ä¼˜å…ˆçº§é¡ºåº

ç³»ç»Ÿé‡‡ç”¨ä»¥ä¸‹ä¼˜å…ˆçº§é¡ºåºåŠ è½½é…ç½®ï¼š

```mermaid
flowchart TD
Start([é…ç½®åŠ è½½å¼€å§‹]) --> EnvFile["åŠ è½½ .env æ–‡ä»¶"]
EnvFile --> EnvVars["æå–ç¯å¢ƒå˜é‡"]
EnvVars --> Settings["åŠ è½½ settings.json"]
Settings --> Merge["åˆå¹¶é…ç½®"]
Merge --> FinalConfig["æœ€ç»ˆé…ç½®"]
subgraph "ç¯å¢ƒå˜é‡è¦†ç›–é¡¹"
APIKeys["APIå¯†é’¥"]
Directories["ç›®å½•é…ç½®"]
Logging["æ—¥å¿—é…ç½®"]
Features["åŠŸèƒ½å¼€å…³"]
end
EnvVars --> APIKeys
EnvVars --> Directories
EnvVars --> Logging
EnvVars --> Features
```

**å›¾è¡¨æ¥æº**
- [tradingagents/config/config_manager.py](file://tradingagents/config/config_manager.py#L450-L500)

### å…³é”®ç¯å¢ƒå˜é‡

#### APIå¯†é’¥ç¯å¢ƒå˜é‡
- **DASHSCOPE_API_KEY**ï¼šé˜¿é‡Œç™¾ç‚¼APIå¯†é’¥
- **OPENAI_API_KEY**ï¼šOpenAI APIå¯†é’¥
- **GOOGLE_API_KEY**ï¼šGoogle APIå¯†é’¥
- **ANTHROPIC_API_KEY**ï¼šAnthropic APIå¯†é’¥
- **DEEPSEEK_API_KEY**ï¼šDeepSeek APIå¯†é’¥

#### ç›®å½•é…ç½®ç¯å¢ƒå˜é‡
- **TRADINGAGENTS_DATA_DIR**ï¼šæ•°æ®ç›®å½•è·¯å¾„
- **TRADINGAGENTS_CACHE_DIR**ï¼šç¼“å­˜ç›®å½•è·¯å¾„
- **TRADINGAGENTS_RESULTS_DIR**ï¼šç»“æœç›®å½•è·¯å¾„

#### åŠŸèƒ½é…ç½®ç¯å¢ƒå˜é‡
- **TRADINGAGENTS_LOG_LEVEL**ï¼šæ—¥å¿—çº§åˆ«
- **TRADINGAGENTS_LOG_DIR**ï¼šæ—¥å¿—ç›®å½•
- **OPENAI_ENABLED**ï¼šOpenAIåŠŸèƒ½å¯ç”¨çŠ¶æ€

### ç¯å¢ƒå˜é‡å¤„ç†å·¥å…·

ç³»ç»Ÿæä¾›äº†å¼ºå¤§çš„ç¯å¢ƒå˜é‡å¤„ç†å·¥å…·ï¼š

```mermaid
classDiagram
class EnvUtils {
+parse_bool_env(env_var, default) bool
+parse_int_env(env_var, default) int
+parse_float_env(env_var, default) float
+parse_str_env(env_var, default) str
+parse_list_env(env_var, separator, default) list
+get_env_info(env_var) dict
+validate_required_env_vars(vars) dict
}
class ConfigManager {
+load_settings() dict
+get_env_config_status() dict
}
ConfigManager --> EnvUtils : uses
```

**å›¾è¡¨æ¥æº**
- [tradingagents/config/env_utils.py](file://tradingagents/config/env_utils.py#L1-L50)

**ç« èŠ‚æ¥æº**
- [tradingagents/config/config_manager.py](file://tradingagents/config/config_manager.py#L450-L520)
- [tradingagents/config/env_utils.py](file://tradingagents/config/env_utils.py#L1-L245)

## æ“ä½œæŒ‡å—

### æ›´æ–°DeepSeekå®šä»·é…ç½®

#### æ­¥éª¤1ï¼šè®¿é—®é…ç½®ç®¡ç†ç•Œé¢
```bash
# å¯åŠ¨Webç®¡ç†ç•Œé¢
python -m streamlit run web/app.py
```

#### æ­¥éª¤2ï¼šå¯¼èˆªåˆ°å®šä»·é…ç½®é¡µé¢
1. æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:8501`
2. åœ¨ä¾§è¾¹æ é€‰æ‹©"å®šä»·è®¾ç½®"
3. æŸ¥çœ‹å½“å‰å®šä»·é…ç½®

#### æ­¥éª¤3ï¼šä¿®æ”¹DeepSeekå®šä»·
1. åœ¨å®šä»·åˆ—è¡¨ä¸­æ‰¾åˆ°"deepseek/deepseek-chat"
2. ä¿®æ”¹è¾“å…¥ä»·æ ¼ä¸ºÂ¥0.0015/1K
3. ä¿®æ”¹è¾“å‡ºä»·æ ¼ä¸ºÂ¥0.0030/1K
4. ç‚¹å‡»"ä¿å­˜å®šä»·"æŒ‰é’®

#### æ­¥éª¤4ï¼šéªŒè¯é…ç½®æ›´æ–°
```python
# ä½¿ç”¨Pythonè„šæœ¬éªŒè¯
from tradingagents.config.config_manager import config_manager

# é‡æ–°åŠ è½½å®šä»·é…ç½®
pricing_configs = config_manager.load_pricing()

# æŸ¥æ‰¾DeepSeeké…ç½®
deepseek_config = next(
    (p for p in pricing_configs if p.provider == "deepseek" and p.model_name == "deepseek-chat"), 
    None
)

if deepseek_config:
    print(f"DeepSeekå®šä»·æ›´æ–°æˆåŠŸ:")
    print(f"è¾“å…¥ä»·æ ¼: Â¥{deepseek_config.input_price_per_1k:.4f}/1K")
    print(f"è¾“å‡ºä»·æ ¼: Â¥{deepseek_config.output_price_per_1k:.4f}/1K")
else:
    print("æœªæ‰¾åˆ°DeepSeeké…ç½®ï¼Œè¯·æ£€æŸ¥é…ç½®æ–‡ä»¶")
```

### æ›´æ–°DashScopeå®šä»·é…ç½®

#### æ–¹æ³•1ï¼šé€šè¿‡Webç•Œé¢
1. åœ¨å®šä»·é…ç½®é¡µé¢é€‰æ‹©"dashscope/qwen-plus-latest"
2. ä¿®æ”¹è¾“å…¥ä»·æ ¼ä¸ºÂ¥0.0045/1K
3. ä¿®æ”¹è¾“å‡ºä»·æ ¼ä¸ºÂ¥0.0135/1K
4. ä¿å­˜æ›´æ”¹

#### æ–¹æ³•2ï¼šé€šè¿‡å‘½ä»¤è¡Œ
```python
# å‘½ä»¤è¡Œæ›´æ–°DashScopeå®šä»·
from tradingagents.config.config_manager import config_manager

# åŠ è½½ç°æœ‰é…ç½®
pricing_configs = config_manager.load_pricing()

# æ›´æ–°DashScopeå®šä»·
for pricing in pricing_configs:
    if pricing.provider == "dashscope" and pricing.model_name == "qwen-plus-latest":
        pricing.input_price_per_1k = 0.0045
        pricing.output_price_per_1k = 0.0135
        break

# ä¿å­˜æ›´æ–°
config_manager.save_pricing(pricing_configs)
print("DashScopeå®šä»·æ›´æ–°å®Œæˆ")
```

### é…ç½®æˆæœ¬è­¦å‘Šé˜ˆå€¼

#### è®¾ç½®æ–°çš„è­¦å‘Šé˜ˆå€¼
```python
# è®¾ç½®æ–°çš„æˆæœ¬è­¦å‘Šé˜ˆå€¼ä¸ºÂ¥200
from tradingagents.config.config_manager import config_manager

# åŠ è½½å½“å‰è®¾ç½®
settings = config_manager.load_settings()

# æ›´æ–°è­¦å‘Šé˜ˆå€¼
settings["cost_alert_threshold"] = 200.0

# ä¿å­˜è®¾ç½®
config_manager.save_settings(settings)
print(f"æˆæœ¬è­¦å‘Šé˜ˆå€¼å·²æ›´æ–°ä¸ºÂ¥{settings['cost_alert_threshold']}")
```

#### é€šè¿‡Webç•Œé¢è®¾ç½®
1. å¯¼èˆªåˆ°"ç³»ç»Ÿè®¾ç½®"é¡µé¢
2. æ‰¾åˆ°"æˆæœ¬è­¦å‘Šé˜ˆå€¼"è®¾ç½®
3. è¾“å…¥æ–°çš„é˜ˆå€¼é‡‘é¢
4. ç‚¹å‡»"ä¿å­˜è®¾ç½®"

### é…ç½®è´§å¸åå¥½

#### è®¾ç½®ä¸ºç¾å…ƒæ˜¾ç¤º
```python
# è®¾ç½®è´§å¸åå¥½ä¸ºUSD
from tradingagents.config.config_manager import config_manager

# åŠ è½½è®¾ç½®
settings = config_manager.load_settings()

# è®¾ç½®è´§å¸åå¥½
settings["currency_preference"] = "USD"

# ä¿å­˜è®¾ç½®
config_manager.save_settings(settings)
print("è´§å¸åå¥½å·²è®¾ç½®ä¸ºç¾å…ƒæ˜¾ç¤º")
```

#### éªŒè¯è´§å¸æ˜¾ç¤º
```python
# éªŒè¯æˆæœ¬è®¡ç®—æ˜¾ç¤º
from tradingagents.config.config_manager import config_manager

# è®¡ç®—ç¤ºä¾‹æˆæœ¬
cost = config_manager.calculate_cost("dashscope", "qwen-turbo", 1000, 500)
print(f"æˆæœ¬æ˜¾ç¤º: ${cost:.4f}")  # åº”æ˜¾ç¤ºç¾å…ƒæ ¼å¼
```

**ç« èŠ‚æ¥æº**
- [examples/config_management_demo.py](file://examples/config_management_demo.py#L203-L257)
- [web/modules/config_management.py](file://web/modules/config_management.py#L427-L442)

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. å®šä»·é…ç½®ä¸ç”Ÿæ•ˆ

**ç—‡çŠ¶**ï¼šä¿®æ”¹å®šä»·åæˆæœ¬è®¡ç®—ä»ä½¿ç”¨æ—§ä»·æ ¼

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# 1. æ£€æŸ¥é…ç½®æ–‡ä»¶è·¯å¾„
from tradingagents.config.config_manager import config_manager
print(f"å®šä»·æ–‡ä»¶è·¯å¾„: {config_manager.pricing_file}")

# 2. éªŒè¯é…ç½®æ–‡ä»¶å†…å®¹
import json
with open(config_manager.pricing_file, 'r', encoding='utf-8') as f:
    data = json.load(f)
    print(f"é…ç½®æ–‡ä»¶åŒ…å« {len(data)} æ¡å®šä»·è®°å½•")

# 3. æ£€æŸ¥å…·ä½“é…ç½®é¡¹
for item in data:
    if item['provider'] == 'deepseek' and item['model_name'] == 'deepseek-chat':
        print(f"DeepSeeké…ç½®: è¾“å…¥={item['input_price_per_1k']}, è¾“å‡º={item['output_price_per_1k']}")
```

#### 2. æˆæœ¬è·Ÿè¸ªåŠŸèƒ½å¼‚å¸¸

**ç—‡çŠ¶**ï¼šä½¿ç”¨è®°å½•ä¸ä¿å­˜æˆ–ç»Ÿè®¡ä¸å‡†ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# 1. æ£€æŸ¥æˆæœ¬è·Ÿè¸ªè®¾ç½®
from tradingagents.config.config_manager import config_manager

settings = config_manager.load_settings()
print(f"æˆæœ¬è·Ÿè¸ªå¯ç”¨: {settings.get('enable_cost_tracking', True)}")

# 2. æ£€æŸ¥MongoDBè¿æ¥çŠ¶æ€
if config_manager.mongodb_storage:
    print(f"MongoDBè¿æ¥: {'æˆåŠŸ' if config_manager.mongodb_storage.is_connected() else 'å¤±è´¥'}")
else:
    print("MongoDBå­˜å‚¨ä¸å¯ç”¨ï¼Œä½¿ç”¨æ–‡ä»¶å­˜å‚¨")

# 3. æ‰‹åŠ¨æ·»åŠ æµ‹è¯•è®°å½•
from tradingagents.config.config_manager import token_tracker

record = token_tracker.track_usage(
    provider="dashscope",
    model_name="qwen-turbo",
    input_tokens=1000,
    output_tokens=500,
    session_id="test_session"
)

if record:
    print(f"æµ‹è¯•è®°å½•æ·»åŠ æˆåŠŸ: æˆæœ¬={record.cost}")
else:
    print("æµ‹è¯•è®°å½•æ·»åŠ å¤±è´¥")
```

#### 3. ç¯å¢ƒå˜é‡é…ç½®å†²çª

**ç—‡çŠ¶**ï¼šWebç•Œé¢æ˜¾ç¤ºçš„é…ç½®ä¸.envæ–‡ä»¶ä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# æ£€æŸ¥ç¯å¢ƒå˜é‡çŠ¶æ€
from tradingagents.config.config_manager import config_manager

env_status = config_manager.get_env_config_status()
print("ç¯å¢ƒå˜é‡é…ç½®çŠ¶æ€:")
for key, value in env_status.items():
    print(f"  {key}: {value}")

# éªŒè¯APIå¯†é’¥æ¥æº
api_keys = env_status.get('api_keys', {})
for provider, has_key in api_keys.items():
    print(f"  {provider}: {'å·²é…ç½®' if has_key else 'æœªé…ç½®'}")
```

#### 4. Webç•Œé¢æ— æ³•è®¿é—®

**ç—‡çŠ¶**ï¼šå¯åŠ¨Webç•Œé¢åæ— æ³•æ‰“å¼€ç®¡ç†é¡µé¢

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥ç«¯å£å ç”¨
netstat -an | grep 8501

# 2. æ£€æŸ¥ä¾èµ–å®‰è£…
pip list | grep streamlit

# 3. é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. ä½¿ç”¨è°ƒè¯•æ¨¡å¼å¯åŠ¨
streamlit run web/app.py --server.port=8502 --server.address=localhost
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 1. å¤§è§„æ¨¡ä½¿ç”¨ç»Ÿè®¡ä¼˜åŒ–
```python
# å¯¹äºå¤§é‡ä½¿ç”¨è®°å½•ï¼Œå»ºè®®ä½¿ç”¨MongoDBå­˜å‚¨
from tradingagents.config.config_manager import config_manager

# æ£€æŸ¥MongoDBé…ç½®
if config_manager.mongodb_storage and config_manager.mongodb_storage.is_connected():
    print("MongoDBå­˜å‚¨å·²å¯ç”¨ï¼Œé€‚åˆå¤§è§„æ¨¡ä½¿ç”¨")
    # MongoDBæŸ¥è¯¢æ›´é«˜æ•ˆ
    stats = config_manager.mongodb_storage.get_usage_statistics(30)
else:
    print("ä½¿ç”¨æ–‡ä»¶å­˜å‚¨ï¼Œå»ºè®®é…ç½®MongoDBä»¥æé«˜æ€§èƒ½")
    # æ–‡ä»¶å­˜å‚¨æŸ¥è¯¢è¾ƒæ…¢
    stats = config_manager.get_usage_statistics(30)
```

#### 2. æˆæœ¬è·Ÿè¸ªæ€§èƒ½ä¼˜åŒ–
```python
# ä¸´æ—¶ç¦ç”¨æˆæœ¬è·Ÿè¸ªä»¥æé«˜æ€§èƒ½
from tradingagents.config.config_manager import config_manager

# åŠ è½½è®¾ç½®
settings = config_manager.load_settings()
settings["enable_cost_tracking"] = False
config_manager.save_settings(settings)

print("æˆæœ¬è·Ÿè¸ªå·²ç¦ç”¨ï¼Œæ€§èƒ½å·²æå‡")
```

**ç« èŠ‚æ¥æº**
- [tests/test_config_management.py](file://tests/test_config_management.py#L1-L100)
- [tradingagents/config/config_manager.py](file://tradingagents/config/config_manager.py#L550-L620)

## æœ€ä½³å®è·µ

### 1. å®šä»·é…ç½®ç®¡ç†

#### å®šæœŸæ›´æ–°å®šä»·
```python
# åˆ›å»ºå®šæœŸæ›´æ–°è„šæœ¬
import schedule
import time
from tradingagents.config.config_manager import config_manager

def update_pricing():
    """å®šæœŸæ›´æ–°LLMæä¾›å•†å®šä»·"""
    print("å¼€å§‹æ›´æ–°å®šä»·é…ç½®...")
    
    # åŠ è½½å½“å‰é…ç½®
    pricing_configs = config_manager.load_pricing()
    
    # æ›´æ–°DeepSeekå®šä»·ï¼ˆç¤ºä¾‹ï¼‰
    for pricing in pricing_configs:
        if pricing.provider == "deepseek":
            # æ ¹æ®æœ€æ–°å¸‚åœºè¡Œæƒ…è°ƒæ•´ä»·æ ¼
            pricing.input_price_per_1k *= 1.05  # ä¸Šè°ƒ5%
            pricing.output_price_per_1k *= 1.05
    
    # ä¿å­˜æ›´æ–°
    config_manager.save_pricing(pricing_configs)
    print("å®šä»·é…ç½®æ›´æ–°å®Œæˆ")

# å®‰æ’æ¯æ—¥æ›´æ–°
schedule.every().day.at("00:00").do(update_pricing)

# è¿è¡Œè°ƒåº¦å™¨
while True:
    schedule.run_pending()
    time.sleep(60)
```

#### ç‰ˆæœ¬æ§åˆ¶é…ç½®å˜æ›´
```bash
# åˆ›å»ºé…ç½®ç‰ˆæœ¬æ§åˆ¶è„šæœ¬
#!/bin/bash
CONFIG_DIR="config"
BACKUP_DIR="config_backups"

# åˆ›å»ºå¤‡ä»½
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
mkdir -p "$BACKUP_DIR/$TIMESTAMP"

# å¤‡ä»½é…ç½®æ–‡ä»¶
cp "$CONFIG_DIR/pricing.json" "$BACKUP_DIR/$TIMESTAMP/"
cp "$CONFIG_DIR/settings.json" "$BACKUP_DIR/$TIMESTAMP/"

echo "é…ç½®å¤‡ä»½å®Œæˆ: $BACKUP_DIR/$TIMESTAMP"
```

### 2. æˆæœ¬ç›‘æ§ç­–ç•¥

#### è®¾ç½®å¤šçº§æˆæœ¬è­¦å‘Š
```python
# å®ç°åˆ†çº§æˆæœ¬è­¦å‘Š
from tradingagents.config.config_manager import config_manager

def check_multi_level_costs():
    """æ£€æŸ¥å¤šçº§æˆæœ¬é˜ˆå€¼"""
    settings = config_manager.load_settings()
    threshold = settings.get('cost_alert_threshold', 100.0)
    
    # è·å–ä»Šæ—¥ç»Ÿè®¡
    today_stats = config_manager.get_usage_statistics(1)
    total_cost = today_stats['total_cost']
    
    # å¤šçº§è­¦å‘Š
    if total_cost >= threshold * 0.8:
        print(f"âš ï¸ ä¸­ç­‰æˆæœ¬è­¦å‘Š: Â¥{total_cost:.2f}")
    elif total_cost >= threshold:
        print(f"ğŸš¨ é«˜æˆæœ¬è­¦å‘Š: Â¥{total_cost:.2f}")
        # å‘é€é€šçŸ¥
        send_cost_alert(total_cost, threshold)

def send_cost_alert(current_cost, threshold):
    """å‘é€æˆæœ¬è­¦å‘Šé€šçŸ¥"""
    message = f"æˆæœ¬è¶…å‡ºé˜ˆå€¼! å½“å‰æˆæœ¬: Â¥{current_cost:.2f}, é˜ˆå€¼: Â¥{threshold:.2f}"
    # å®ç°é€šçŸ¥é€»è¾‘ï¼ˆé‚®ä»¶ã€çŸ­ä¿¡ç­‰ï¼‰
    print(message)
```

#### æˆæœ¬åˆ†ææŠ¥å‘Š
```python
# ç”Ÿæˆæˆæœ¬åˆ†ææŠ¥å‘Š
def generate_cost_report():
    """ç”Ÿæˆè¯¦ç»†çš„æˆæœ¬åˆ†ææŠ¥å‘Š"""
    stats = config_manager.get_usage_statistics(30)
    
    report = {
        "æ€»æˆæœ¬": f"Â¥{stats['total_cost']:.2f}",
        "æ€»è¯·æ±‚æ•°": stats['total_requests'],
        "å¹³å‡æˆæœ¬": f"Â¥{stats['total_cost']/stats['total_requests']:.4f}",
        "Tokenæ•ˆç‡": {
            "è¾“å…¥Token": stats['total_input_tokens'],
            "è¾“å‡ºToken": stats['total_output_tokens'],
            "Token/æˆæœ¬": f"{(stats['total_input_tokens'] + stats['total_output_tokens'])/stats['total_cost']:.2f}"
        },
        "ä¾›åº”å•†åˆ†å¸ƒ": {}
    }
    
    # ä¾›åº”å•†æˆæœ¬åˆ†å¸ƒ
    for provider, data in stats['provider_stats'].items():
        report["ä¾›åº”å•†åˆ†å¸ƒ"][provider] = {
            "æˆæœ¬": f"Â¥{data['cost']:.2f}",
            "è¯·æ±‚æ•°": data['requests'],
            "å æ¯”": f"{data['cost']/stats['total_cost']*100:.1f}%"
        }
    
    return report
```

### 3. ç¯å¢ƒå˜é‡ç®¡ç†

#### å®‰å…¨çš„ç¯å¢ƒå˜é‡é…ç½®
```python
# åˆ›å»ºå®‰å…¨çš„ç¯å¢ƒå˜é‡ç®¡ç†è„šæœ¬
import os
from tradingagents.config.env_utils import parse_bool_env, parse_float_env

def secure_load_env():
    """å®‰å…¨åŠ è½½ç¯å¢ƒå˜é‡"""
    # éªŒè¯å¿…éœ€çš„APIå¯†é’¥
    required_keys = ['DASHSCOPE_API_KEY', 'OPENAI_API_KEY']
    missing_keys = []
    
    for key in required_keys:
        value = os.getenv(key)
        if not value:
            missing_keys.append(key)
    
    if missing_keys:
        raise ValueError(f"ç¼ºå°‘å¿…éœ€çš„ç¯å¢ƒå˜é‡: {missing_keys}")
    
    # å®‰å…¨è§£æé…ç½®
    settings = {
        'enable_cost_tracking': parse_bool_env('ENABLE_COST_TRACKING', True),
        'cost_alert_threshold': parse_float_env('COST_ALERT_THRESHOLD', 100.0),
        'log_level': os.getenv('TRADINGAGENTS_LOG_LEVEL', 'INFO')
    }
    
    return settings
```

#### ç¯å¢ƒå˜é‡éªŒè¯
```python
# ç¯å¢ƒå˜é‡éªŒè¯è„šæœ¬
def validate_environment():
    """éªŒè¯ç¯å¢ƒå˜é‡é…ç½®"""
    import os
    
    validation_results = {
        'api_keys': {},
        'directories': {},
        'features': {}
    }
    
    # éªŒè¯APIå¯†é’¥
    api_keys = ['DASHSCOPE_API_KEY', 'OPENAI_API_KEY', 'GOOGLE_API_KEY']
    for key in api_keys:
        value = os.getenv(key)
        validation_results['api_keys'][key] = {
            'present': bool(value),
            'length': len(value) if value else 0,
            'secure': not value or len(value) > 10  # è‡³å°‘10ä½é•¿åº¦
        }
    
    # éªŒè¯ç›®å½•
    directories = ['TRADINGAGENTS_DATA_DIR', 'TRADINGAGENTS_CACHE_DIR']
    for dir_name in directories:
        path = os.getenv(dir_name)
        validation_results['directories'][dir_name] = {
            'exists': os.path.exists(path) if path else False,
            'writable': os.access(path, os.W_OK) if path else False
        }
    
    return validation_results
```

### 4. ç›‘æ§å’Œç»´æŠ¤

#### è‡ªåŠ¨åŒ–ç›‘æ§è„šæœ¬
```python
# æˆæœ¬ç›‘æ§è‡ªåŠ¨åŒ–è„šæœ¬
import smtplib
from email.mime.text import MIMEText
from tradingagents.config.config_manager import config_manager

def monitor_costs():
    """è‡ªåŠ¨åŒ–æˆæœ¬ç›‘æ§"""
    try:
        # è·å–é…ç½®å’Œç»Ÿè®¡
        settings = config_manager.load_settings()
        stats = config_manager.get_usage_statistics(1)
        
        # æ£€æŸ¥æˆæœ¬æ˜¯å¦è¶…é™
        if stats['total_cost'] >= settings.get('cost_alert_threshold', 100.0):
            # å‘é€é‚®ä»¶é€šçŸ¥
            send_email_notification(stats)
        
        # è®°å½•ç›‘æ§æ—¥å¿—
        log_monitoring_event(stats)
        
    except Exception as e:
        log_error(f"æˆæœ¬ç›‘æ§å¤±è´¥: {e}")

def send_email_notification(stats):
    """å‘é€æˆæœ¬è¶…é™é‚®ä»¶"""
    subject = "TradingAgentsæˆæœ¬è¶…é™è­¦å‘Š"
    body = f"""
    æˆæœ¬è¶…é™è­¦å‘Š
    
    å½“å‰æˆæœ¬: Â¥{stats['total_cost']:.2f}
    è¯·æ±‚æ¬¡æ•°: {stats['total_requests']}
    è¶…è¿‡é˜ˆå€¼: Â¥{stats['total_cost'] - settings.get('cost_alert_threshold', 100.0):.2f}
    
    è¯·åŠæ—¶æ£€æŸ¥!
    """
    
    msg = MIMEText(body)
    msg['Subject'] = subject
    msg['From'] = "monitor@example.com"
    msg['To'] = "admin@example.com"
    
    # å‘é€é‚®ä»¶ï¼ˆéœ€è¦é…ç½®SMTPæœåŠ¡å™¨ï¼‰
    # server = smtplib.SMTP('smtp.example.com')
    # server.send_message(msg)
    # server.quit()

def log_monitoring_event(stats):
    """è®°å½•ç›‘æ§äº‹ä»¶"""
    from datetime import datetime
    
    event = {
        'timestamp': datetime.now().isoformat(),
        'total_cost': stats['total_cost'],
        'total_requests': stats['total_requests'],
        'status': 'normal' if stats['total_cost'] < settings.get('cost_alert_threshold', 100.0) else 'alert'
    }
    
    # è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶
    with open('cost_monitoring.log', 'a') as f:
        f.write(f"{event}\n")
```

è¿™äº›æœ€ä½³å®è·µå¯ä»¥å¸®åŠ©æ‚¨æ›´å¥½åœ°ç®¡ç†å’Œä¼˜åŒ–TradingAgents-CNçš„æˆæœ¬é…ç½®ç³»ç»Ÿï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šè¿è¡Œå’Œæˆæœ¬çš„æœ‰æ•ˆæ§åˆ¶ã€‚