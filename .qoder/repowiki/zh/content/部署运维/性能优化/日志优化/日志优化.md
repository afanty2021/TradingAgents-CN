# æ—¥å¿—ç³»ç»Ÿä¼˜åŒ–æŒ‡å—

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**
- [config/logging.toml](file://config/logging.toml)
- [config/logging_docker.toml](file://config/logging_docker.toml)
- [tradingagents/utils/logging_init.py](file://tradingagents/utils/logging_init.py)
- [tradingagents/utils/logging_manager.py](file://tradingagents/utils/logging_manager.py)
- [scripts/test_docker_logging.py](file://scripts/test_docker_logging.py)
- [scripts/fix_docker_logging.py](file://scripts/fix_docker_logging.py)
- [examples/simple_analysis_demo.py](file://examples/simple_analysis_demo.py)
- [tradingagents/dataflows/stock_data_service.py](file://tradingagents/dataflows/stock_data_service.py)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [æ—¥å¿—é…ç½®æ–‡ä»¶ç»“æ„](#æ—¥å¿—é…ç½®æ–‡ä»¶ç»“æ„)
3. [å…¨å±€æ—¥å¿—çº§åˆ«é…ç½®](#å…¨å±€æ—¥å¿—çº§åˆ«é…ç½®)
4. [å¤„ç†å™¨é…ç½®è¯¦è§£](#å¤„ç†å™¨é…ç½®è¯¦è§£)
5. [æ—¥å¿—æ ¼å¼è‡ªå®šä¹‰](#æ—¥å¿—æ ¼å¼è‡ªå®šä¹‰)
6. [ç¯å¢ƒç‰¹å®šé…ç½®](#ç¯å¢ƒç‰¹å®šé…ç½®)
7. [é«˜çº§åŠŸèƒ½é…ç½®](#é«˜çº§åŠŸèƒ½é…ç½®)
8. [æ€§èƒ½ç›‘æ§æ—¥å¿—](#æ€§èƒ½ç›‘æ§æ—¥å¿—)
9. [å®‰å…¨æ—¥å¿—é…ç½®](#å®‰å…¨æ—¥å¿—é…ç½®)
10. [ä¸šåŠ¡æ—¥å¿—é…ç½®](#ä¸šåŠ¡æ—¥å¿—é…ç½®)
11. [æ—¥å¿—çº§åˆ«å¯¹æ€§èƒ½çš„å½±å“](#æ—¥å¿—çº§åˆ«å¯¹æ€§èƒ½çš„å½±å“)
12. [å¤§æ—¥å¿—æ–‡ä»¶åˆ†å‰²ç­–ç•¥](#å¤§æ—¥å¿—æ–‡ä»¶åˆ†å‰²ç­–ç•¥)
13. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
14. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

## ç®€ä»‹

TradingAgents-CNé‡‡ç”¨äº†ä¸€å¥—å®Œæ•´çš„æ—¥å¿—ç³»ç»Ÿï¼Œæ”¯æŒå¤šç¯å¢ƒéƒ¨ç½²ã€å¤šç§æ—¥å¿—æ ¼å¼å’Œä¸°å¯Œçš„ç›‘æ§åŠŸèƒ½ã€‚è¯¥ç³»ç»ŸåŸºäºPythonæ ‡å‡†loggingæ¨¡å—æ„å»ºï¼Œæä¾›äº†çµæ´»çš„é…ç½®é€‰é¡¹å’Œå¼ºå¤§çš„æ‰©å±•èƒ½åŠ›ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **å¤šç¯å¢ƒæ”¯æŒ**ï¼šå¼€å‘ã€ç”Ÿäº§ã€Dockerç¯å¢ƒçš„ä¸“é—¨é…ç½®
- **å¤šç§æ ¼å¼**ï¼šæ§åˆ¶å°ã€æ–‡ä»¶ã€ç»“æ„åŒ–(JSON)æ—¥å¿—
- **æ™ºèƒ½è·¯ç”±**ï¼šä¸åŒæ¨¡å—çš„ç‹¬ç«‹æ—¥å¿—çº§åˆ«æ§åˆ¶
- **æ€§èƒ½ç›‘æ§**ï¼šæ…¢æ“ä½œè®°å½•å’Œå†…å­˜ä½¿ç”¨è·Ÿè¸ª
- **å®‰å…¨å®¡è®¡**ï¼šAPIè°ƒç”¨å’ŒTokenä½¿ç”¨è¿½è¸ª
- **ä¸šåŠ¡æ´å¯Ÿ**ï¼šç”¨æˆ·æ“ä½œå’Œåˆ†æäº‹ä»¶è®°å½•

## æ—¥å¿—é…ç½®æ–‡ä»¶ç»“æ„

### ä¸»é…ç½®æ–‡ä»¶æ¶æ„

```mermaid
graph TD
A[logging.toml] --> B[å…¨å±€é…ç½®]
A --> C[å¤„ç†å™¨é…ç½®]
A --> D[æ—¥å¿—å™¨é…ç½®]
A --> E[ç¯å¢ƒé…ç½®]
A --> F[åŠŸèƒ½æ¨¡å—é…ç½®]
B --> B1[å…¨å±€æ—¥å¿—çº§åˆ«]
B --> B2[æ—¥å¿—æ ¼å¼æ¨¡æ¿]
C --> C1[æ§åˆ¶å°å¤„ç†å™¨]
C --> C2[æ–‡ä»¶å¤„ç†å™¨]
C --> C3[ç»“æ„åŒ–å¤„ç†å™¨]
D --> D1[åº”ç”¨æ¨¡å—æ—¥å¿—å™¨]
D --> D2[ç¬¬ä¸‰æ–¹åº“æ—¥å¿—å™¨]
E --> E1[Dockerç¯å¢ƒ]
E --> E2[å¼€å‘ç¯å¢ƒ]
E --> E3[ç”Ÿäº§ç¯å¢ƒ]
F --> F1[æ€§èƒ½ç›‘æ§]
F --> F2[å®‰å…¨å®¡è®¡]
F --> F3[ä¸šåŠ¡æ—¥å¿—]
```

**å›¾è¡¨æ¥æº**
- [config/logging.toml](file://config/logging.toml#L1-L111)

### é…ç½®æ–‡ä»¶å±‚æ¬¡ç»“æ„

| é…ç½®å±‚çº§ | ç”¨é€” | ç¤ºä¾‹ |
|---------|------|------|
| `[logging]` | å…¨å±€è®¾ç½® | æ—¥å¿—çº§åˆ«ã€æ ¼å¼æ¨¡æ¿ |
| `[logging.handlers]` | å¤„ç†å™¨é…ç½® | æ§åˆ¶å°ã€æ–‡ä»¶ã€ç»“æ„åŒ– |
| `[logging.loggers]` | æ¨¡å—æ—¥å¿—å™¨ | tradingagentsã€webã€dataflows |
| `[logging.docker]` | Dockerç¯å¢ƒ | stdout_onlyã€disable_file_logging |
| `[logging.performance]` | æ€§èƒ½ç›‘æ§ | æ…¢æ“ä½œé˜ˆå€¼ã€å†…å­˜ç›‘æ§ |
| `[logging.security]` | å®‰å…¨å®¡è®¡ | APIè°ƒç”¨ã€Tokenä½¿ç”¨ |
| `[logging.business]` | ä¸šåŠ¡æ—¥å¿— | ç”¨æˆ·æ“ä½œã€åˆ†æäº‹ä»¶ |

**ç« èŠ‚æ¥æº**
- [config/logging.toml](file://config/logging.toml#L1-L111)

## å…¨å±€æ—¥å¿—çº§åˆ«é…ç½®

### æ—¥å¿—çº§åˆ«å±‚æ¬¡

```mermaid
graph LR
A[CRITICAL] --> B[ERROR]
B --> C[WARNING]
C --> D[INFO]
D --> E[DEBUG]
style A fill:#ff9999
style B fill:#ffcc99
style C fill:#ffff99
style D fill:#ccffcc
style E fill:#ccccff
```

### çº§åˆ«è¯´æ˜ä¸ä½¿ç”¨åœºæ™¯

| çº§åˆ« | æ•°å€¼ | ç”¨é€” | ç¤ºä¾‹åœºæ™¯ |
|------|------|------|----------|
| DEBUG | 10 | è¯¦ç»†è°ƒè¯•ä¿¡æ¯ | å¼€å‘é˜¶æ®µçš„è¯¦ç»†æ‰§è¡Œè¿‡ç¨‹ |
| INFO | 20 | ä¸€èˆ¬ä¿¡æ¯è®°å½• | æ­£å¸¸æ“ä½œçš„ç¡®è®¤ä¿¡æ¯ |
| WARNING | 30 | è­¦å‘Šä½†ç»§ç»­è¿è¡Œ | é™çº§æ–¹æ¡ˆå¯ç”¨ã€é…ç½®é—®é¢˜ |
| ERROR | 40 | é”™è¯¯ä½†ç»§ç»­è¿è¡Œ | å•ä¸ªç»„ä»¶å¤±è´¥ä½†ä¸å½±å“æ•´ä½“ |
| CRITICAL | 50 | ä¸¥é‡é”™è¯¯ | ç³»ç»Ÿçº§æ•…éšœã€æ— æ³•æ¢å¤ |

### å…¨å±€çº§åˆ«è®¾ç½®

```toml
[logging]
level = "INFO"  # å…¨å±€é»˜è®¤çº§åˆ«
```

**ç« èŠ‚æ¥æº**
- [config/logging.toml](file://config/logging.toml#L4-L6)

## å¤„ç†å™¨é…ç½®è¯¦è§£

### æ§åˆ¶å°å¤„ç†å™¨

æ§åˆ¶å°å¤„ç†å™¨è´Ÿè´£å®æ—¶è¾“å‡ºæ—¥å¿—åˆ°ç»ˆç«¯ï¼Œæ”¯æŒå½©è‰²è¾“å‡ºå’ŒåŠ¨æ€çº§åˆ«æ§åˆ¶ã€‚

```mermaid
flowchart TD
A[æ§åˆ¶å°å¤„ç†å™¨] --> B{å¯ç”¨çŠ¶æ€}
B --> |true| C[è®¾ç½®çº§åˆ«]
B --> |false| D[è·³è¿‡]
C --> E{å½©è‰²è¾“å‡º}
E --> |true| F[æ·»åŠ ANSIé¢œè‰²]
E --> |false| G[æ ‡å‡†æ ¼å¼]
F --> H[è¾“å‡ºåˆ°stdout]
G --> H
```

**å›¾è¡¨æ¥æº**
- [tradingagents/utils/logging_manager.py](file://tradingagents/utils/logging_manager.py#L195-L228)

#### é…ç½®å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| enabled | boolean | true | æ˜¯å¦å¯ç”¨æ§åˆ¶å°è¾“å‡º |
| colored | boolean | true | æ˜¯å¦å¯ç”¨å½©è‰²è¾“å‡º |
| level | string | "INFO" | å¤„ç†å™¨çº§åˆ« |

#### æ ¼å¼åŒ–é€‰é¡¹

- **æ™®é€šæ ¼å¼**ï¼š`%(asctime)s | %(name)-20s | %(levelname)-8s | %(message)s`
- **å½©è‰²æ ¼å¼**ï¼šè‡ªåŠ¨æ·»åŠ ANSIé¢œè‰²ç 

**ç« èŠ‚æ¥æº**
- [config/logging.toml](file://config/logging.toml#L12-L18)

### æ–‡ä»¶å¤„ç†å™¨

æ–‡ä»¶å¤„ç†å™¨å°†æ—¥å¿—æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ”¯æŒè‡ªåŠ¨è½®è½¬å’Œå¤§å°é™åˆ¶ã€‚

```mermaid
sequenceDiagram
participant App as åº”ç”¨ç¨‹åº
participant Handler as æ–‡ä»¶å¤„ç†å™¨
participant Rotator as è½®è½¬å™¨
participant FS as æ–‡ä»¶ç³»ç»Ÿ
App->>Handler : å†™å…¥æ—¥å¿—
Handler->>FS : æ£€æŸ¥æ–‡ä»¶å¤§å°
alt è¶…è¿‡é™åˆ¶
Handler->>Rotator : è§¦å‘è½®è½¬
Rotator->>FS : é‡å‘½åæ—§æ–‡ä»¶
Rotator->>FS : åˆ›å»ºæ–°æ–‡ä»¶
end
Handler->>FS : å†™å…¥æ—¥å¿—å†…å®¹
```

**å›¾è¡¨æ¥æº**
- [tradingagents/utils/logging_manager.py](file://tradingagents/utils/logging_manager.py#L226-L260)

#### é…ç½®å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| enabled | boolean | true | æ˜¯å¦å¯ç”¨æ–‡ä»¶æ—¥å¿— |
| level | string | "DEBUG" | å¤„ç†å™¨çº§åˆ« |
| max_size | string | "10MB" | å•ä¸ªæ–‡ä»¶æœ€å¤§å¤§å° |
| backup_count | integer | 5 | ä¿ç•™çš„å¤‡ä»½æ–‡ä»¶æ•°é‡ |
| directory | string | "./logs" | æ—¥å¿—æ–‡ä»¶ç›®å½• |

#### å¤§å°è§£æè§„åˆ™

- æ”¯æŒå•ä½ï¼šKBã€MBã€GB
- ç¤ºä¾‹ï¼š`"10MB"`ã€`"500KB"`ã€`"2GB"`

**ç« èŠ‚æ¥æº**
- [config/logging.toml](file://config/logging.toml#L20-L28)

### ç»“æ„åŒ–å¤„ç†å™¨

ç»“æ„åŒ–å¤„ç†å™¨å°†æ—¥å¿—è¾“å‡ºä¸ºJSONæ ¼å¼ï¼Œä¾¿äºåç»­åˆ†æå’Œç›‘æ§ã€‚

```mermaid
classDiagram
class StructuredFormatter {
+format(record) string
-add_timestamp()
-add_extra_fields()
-mask_sensitive_data()
}
class LogEntry {
+timestamp string
+level string
+logger string
+message string
+module string
+function string
+line integer
+session_id string
+analysis_type string
+stock_symbol string
+cost float
+tokens dict
}
StructuredFormatter --> LogEntry : creates
```

**å›¾è¡¨æ¥æº**
- [tradingagents/utils/logging_manager.py](file://tradingagents/utils/logging_manager.py#L42-L88)

#### é…ç½®å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| enabled | boolean | false | æ˜¯å¦å¯ç”¨ç»“æ„åŒ–æ—¥å¿— |
| level | string | "INFO" | å¤„ç†å™¨çº§åˆ« |
| directory | string | "./logs" | æ—¥å¿—æ–‡ä»¶ç›®å½• |

#### è‡ªåŠ¨æ·»åŠ çš„å­—æ®µ

- `session_id`: ä¼šè¯æ ‡è¯†ç¬¦
- `analysis_type`: åˆ†æç±»å‹
- `stock_symbol`: è‚¡ç¥¨ä»£ç 
- `cost`: æˆæœ¬ä¿¡æ¯
- `tokens`: Tokenä½¿ç”¨ç»Ÿè®¡

**ç« èŠ‚æ¥æº**
- [config/logging.toml](file://config/logging.toml#L30-L36)

## æ—¥å¿—æ ¼å¼è‡ªå®šä¹‰

### æ ¼å¼æ¨¡æ¿ç³»ç»Ÿ

```mermaid
graph TD
A[æ ¼å¼æ¨¡æ¿] --> B[æ§åˆ¶å°æ ¼å¼]
A --> C[æ–‡ä»¶æ ¼å¼]
A --> D[ç»“æ„åŒ–æ ¼å¼]
B --> B1[æ—¶é—´æˆ³ | æ¨¡å—å | çº§åˆ« | æ¶ˆæ¯]
C --> C1[å®Œæ•´ä¸Šä¸‹æ–‡ä¿¡æ¯]
D --> D1[JSONç»“æ„åŒ–æ•°æ®]
B1 --> B2[%(...s)æ ¼å¼åŒ–]
C1 --> C2[æ¨¡å—:å‡½æ•°:è¡Œå·]
D1 --> D2[é”®å€¼å¯¹å½¢å¼]
```

### æ§åˆ¶å°æ ¼å¼

**é»˜è®¤æ ¼å¼**ï¼š
```
%(asctime)s | %(name)-20s | %(levelname)-8s | %(message)s
```

**ç¤ºä¾‹è¾“å‡º**ï¼š
```
2024-01-15 10:30:45.123 | tradingagents.dataflows  | INFO     | è‚¡ç¥¨æ•°æ®è·å–å®Œæˆ
```

### æ–‡ä»¶æ ¼å¼

**é»˜è®¤æ ¼å¼**ï¼š
```
%(asctime)s | %(name)-20s | %(levelname)-8s | %(module)s:%(funcName)s:%(lineno)d | %(message)s
```

**ç¤ºä¾‹è¾“å‡º**ï¼š
```
2024-01-15 10:30:45.123 | tradingagents.dataflows | INFO     | stock_data_service:get_stock_basic_info:45 | è‚¡ç¥¨åŸºç¡€ä¿¡æ¯è·å–æˆåŠŸ
```

### ç»“æ„åŒ–æ ¼å¼

**JSONè¾“å‡º**ï¼š
```json
{
  "timestamp": "2024-01-15T10:30:45.123456",
  "level": "INFO",
  "logger": "tradingagents.dataflows",
  "message": "è‚¡ç¥¨æ•°æ®è·å–å®Œæˆ",
  "module": "stock_data_service",
  "function": "get_stock_basic_info",
  "line": 45
}
```

**ç« èŠ‚æ¥æº**
- [config/logging.toml](file://config/logging.toml#L8-L10)

## ç¯å¢ƒç‰¹å®šé…ç½®

### Dockerç¯å¢ƒé…ç½®

Dockerç¯å¢ƒå…·æœ‰ç‰¹æ®Šçš„é…ç½®è¦æ±‚ï¼Œä¸»è¦è§£å†³å®¹å™¨åŒ–éƒ¨ç½²ä¸­çš„æ—¥å¿—è¾“å‡ºé—®é¢˜ã€‚

```mermaid
flowchart TD
A[Dockerç¯å¢ƒæ£€æµ‹] --> B{DOCKER_CONTAINERç¯å¢ƒå˜é‡}
B --> |true| C[å¯ç”¨Dockeré…ç½®]
B --> |false| D[ä½¿ç”¨æ ‡å‡†é…ç½®]
C --> E[stdout_only = false]
C --> F[disable_file_logging = false]
C --> G[ç›®å½• = /app/logs]
E --> H[åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ–‡ä»¶]
F --> H
G --> H
```

**å›¾è¡¨æ¥æº**
- [config/logging_docker.toml](file://config/logging_docker.toml#L70-L75)

#### Dockeré…ç½®å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| enabled | boolean | auto-detect | è‡ªåŠ¨æ£€æµ‹Dockerç¯å¢ƒ |
| stdout_only | boolean | false | æ˜¯å¦åªè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º |
| disable_file_logging | boolean | false | æ˜¯å¦ç¦ç”¨æ–‡ä»¶æ—¥å¿— |

#### Dockerä¸“ç”¨é…ç½®

```toml
[logging.docker]
enabled = true
stdout_only = false
disable_file_logging = false

[logging.handlers.file]
directory = "/app/logs"
max_size = "100MB"
backup_count = 5
```

**ç« èŠ‚æ¥æº**
- [config/logging_docker.toml](file://config/logging_docker.toml#L70-L80)

### å¼€å‘ç¯å¢ƒé…ç½®

å¼€å‘ç¯å¢ƒå¼ºè°ƒè°ƒè¯•ä¿¡æ¯å’Œè¯¦ç»†çš„æ‰§è¡Œè·Ÿè¸ªã€‚

#### é…ç½®ç‰¹ç‚¹

- **è¯¦ç»†æ—¥å¿—**ï¼šå¯ç”¨DEBUGçº§åˆ«
- **æ¨¡å—é€‰æ‹©æ€§**ï¼šç‰¹å®šæ¨¡å—çš„è¯¦ç»†æ—¥å¿—
- **æ–‡ä»¶ä¿å­˜**ï¼šä¿ç•™è°ƒè¯•æ–‡ä»¶

#### é…ç½®ç¤ºä¾‹

```toml
[logging.development]
enabled = true
debug_modules = ["tradingagents.graph", "tradingagents.llm_adapters"]
save_debug_files = true
```

**ç« èŠ‚æ¥æº**
- [config/logging.toml](file://config/logging.toml#L73-L77)

### ç”Ÿäº§ç¯å¢ƒé…ç½®

ç”Ÿäº§ç¯å¢ƒæ³¨é‡æ€§èƒ½å’Œç»“æ„åŒ–è¾“å‡ºã€‚

#### é…ç½®ç‰¹ç‚¹

- **ç»“æ„åŒ–æ—¥å¿—**ï¼šå¯ç”¨JSONæ ¼å¼
- **ä¸¥æ ¼çº§åˆ«**ï¼šINFOåŠä»¥ä¸Šçº§åˆ«
- **å¤§æ–‡ä»¶æ”¯æŒ**ï¼š100MBå•æ–‡ä»¶é™åˆ¶

#### é…ç½®ç¤ºä¾‹

```toml
[logging.production]
enabled = true
structured_only = true
error_notification = true
max_log_size = "100MB"
```

**ç« èŠ‚æ¥æº**
- [config/logging.toml](file://config/logging.toml#L79-L84)

## é«˜çº§åŠŸèƒ½é…ç½®

### æ¨¡å—ç‰¹å®šæ—¥å¿—å™¨

ç³»ç»Ÿä¸ºä¸åŒæ¨¡å—è®¾ç½®äº†ä¸“é—¨çš„æ—¥å¿—å™¨ï¼Œå…è®¸ç‹¬ç«‹æ§åˆ¶æ¯ä¸ªæ¨¡å—çš„æ—¥å¿—çº§åˆ«ã€‚

```mermaid
graph TD
A[æ¨¡å—æ—¥å¿—å™¨é…ç½®] --> B[æ ¸å¿ƒåº”ç”¨]
A --> C[Webç•Œé¢]
A --> D[æ•°æ®æµ]
A --> E[LLMé€‚é…å™¨]
A --> F[ç¬¬ä¸‰æ–¹åº“]
B --> B1[tradingagents: INFO]
C --> C1[web: INFO]
D --> D1[dataflows: INFO]
E --> E1[llm_adapters: INFO]
F --> F1[streamlit: WARNING<br/>urllib3: WARNING<br/>requests: WARNING]
```

**å›¾è¡¨æ¥æº**
- [config/logging.toml](file://config/logging.toml#L38-L68)

#### æ ¸å¿ƒæ¨¡å—é…ç½®

| æ¨¡å— | æ—¥å¿—çº§åˆ« | è¯´æ˜ |
|------|----------|------|
| tradingagents | INFO | ä¸»åº”ç”¨é€»è¾‘ |
| web | INFO | Webç•Œé¢æ“ä½œ |
| dataflows | INFO | æ•°æ®å¤„ç†æµç¨‹ |
| llm_adapters | INFO | AIæ¨¡å‹é€‚é…å™¨ |
| streamlit | WARNING | Webæ¡†æ¶å™ªéŸ³è¿‡æ»¤ |
| urllib3 | WARNING | HTTPè¯·æ±‚å™ªéŸ³è¿‡æ»¤ |
| requests | WARNING | è¯·æ±‚åº“å™ªéŸ³è¿‡æ»¤ |

**ç« èŠ‚æ¥æº**
- [config/logging.toml](file://config/logging.toml#L38-L68)

### ç¯å¢ƒå˜é‡æ”¯æŒ

ç³»ç»Ÿæ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–é…ç½®ï¼š

| ç¯å¢ƒå˜é‡ | é»˜è®¤å€¼ | è¯´æ˜ |
|----------|--------|------|
| TRADINGAGENTS_LOG_LEVEL | INFO | å…¨å±€æ—¥å¿—çº§åˆ« |
| TRADINGAGENTS_LOG_DIR | ./logs | æ—¥å¿—æ–‡ä»¶ç›®å½• |
| DOCKER_CONTAINER | false | Dockerç¯å¢ƒæ£€æµ‹ |

**ç« èŠ‚æ¥æº**
- [tradingagents/utils/logging_manager.py](file://tradingagents/utils/logging_manager.py#L90-L128)

## æ€§èƒ½ç›‘æ§æ—¥å¿—

### æ…¢æ“ä½œè®°å½•

ç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹å’Œè®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡é˜ˆå€¼çš„æ“ä½œã€‚

```mermaid
flowchart TD
A[æ“ä½œå¼€å§‹] --> B[è®°å½•å¼€å§‹æ—¶é—´]
B --> C[æ‰§è¡Œæ“ä½œ]
C --> D[è®°å½•ç»“æŸæ—¶é—´]
D --> E{æ‰§è¡Œæ—¶é—´ > é˜ˆå€¼?}
E --> |æ˜¯| F[è®°å½•æ…¢æ“ä½œæ—¥å¿—]
E --> |å¦| G[æ­£å¸¸å®Œæˆ]
F --> H[åŒ…å«è¯¦ç»†ä¸Šä¸‹æ–‡]
H --> I[è¾“å‡ºåˆ°æ€§èƒ½æ—¥å¿—]
```

#### é…ç½®å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| enabled | boolean | true | æ˜¯å¦å¯ç”¨æ…¢æ“ä½œç›‘æ§ |
| log_slow_operations | boolean | true | æ˜¯å¦è®°å½•æ…¢æ“ä½œ |
| slow_threshold_seconds | float | 5.0 | æ…¢æ“ä½œé˜ˆå€¼(ç§’) |
| log_memory_usage | boolean | false | æ˜¯å¦è®°å½•å†…å­˜ä½¿ç”¨ |

#### æ…¢æ“ä½œæ—¥å¿—ç¤ºä¾‹

```
2024-01-15 10:30:45.123 | tradingagents.dataflows | WARNING  | åˆ†æå®Œæˆ - è‚¡ç¥¨: AAPL, è€—æ—¶: 8.23s, æˆæœ¬: Â¥0.0012
```

**ç« èŠ‚æ¥æº**
- [config/logging.toml](file://config/logging.toml#L86-L91)

### æ€§èƒ½æŒ‡æ ‡æ”¶é›†

ç³»ç»Ÿè‡ªåŠ¨æ”¶é›†ä»¥ä¸‹æ€§èƒ½æŒ‡æ ‡ï¼š

- **æ‰§è¡Œæ—¶é—´**ï¼šå„æ¨¡å—æ“ä½œè€—æ—¶
- **å†…å­˜ä½¿ç”¨**ï¼šå³°å€¼å†…å­˜å ç”¨
- **Tokenä½¿ç”¨**ï¼šAPIè°ƒç”¨æˆæœ¬ç»Ÿè®¡
- **ååé‡**ï¼šæ“ä½œé¢‘ç‡ç»Ÿè®¡

**ç« èŠ‚æ¥æº**
- [tradingagents/utils/logging_manager.py](file://tradingagents/utils/logging_manager.py#L320-L380)

## å®‰å…¨æ—¥å¿—é…ç½®

### APIè°ƒç”¨è¿½è¸ª

ç³»ç»Ÿè®°å½•æ‰€æœ‰å¤–éƒ¨APIè°ƒç”¨çš„è¯¦ç»†ä¿¡æ¯ã€‚

```mermaid
sequenceDiagram
participant App as åº”ç”¨ç¨‹åº
participant Logger as å®‰å…¨æ—¥å¿—å™¨
participant API as å¤–éƒ¨API
participant Monitor as ç›‘æ§ç³»ç»Ÿ
App->>Logger : è®°å½•APIè°ƒç”¨å¼€å§‹
App->>API : å‘é€è¯·æ±‚
API-->>App : è¿”å›å“åº”
App->>Logger : è®°å½•APIè°ƒç”¨å®Œæˆ
Logger->>Monitor : å‘é€å®‰å…¨äº‹ä»¶
```

#### APIå®‰å…¨é…ç½®

| åŠŸèƒ½ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| log_api_calls | true | è®°å½•APIè°ƒç”¨ |
| log_token_usage | true | è®°å½•Tokenä½¿ç”¨ |
| mask_sensitive_data | true | å±è”½æ•æ„Ÿä¿¡æ¯ |

#### APIè°ƒç”¨æ—¥å¿—ç¤ºä¾‹

```
2024-01-15 10:30:45.123 | llm_adapters.deepseek | INFO     | ğŸ“Š Tokenä½¿ç”¨ - deepseek/qwen-plus: è¾“å…¥=1200, è¾“å‡º=300, æˆæœ¬=Â¥0.0015
```

**ç« èŠ‚æ¥æº**
- [config/logging.toml](file://config/logging.toml#L93-L98)

### æ•æ„Ÿæ•°æ®ä¿æŠ¤

ç³»ç»Ÿè‡ªåŠ¨å±è”½å’Œè„±æ•æ•æ„Ÿä¿¡æ¯ï¼š

- **APIå¯†é’¥**ï¼šæ˜¾ç¤ºå‰8ä½ï¼Œå…¶ä½™ç”¨"..."æ›¿ä»£
- **ç”¨æˆ·å‡­æ®**ï¼šå®Œå…¨å±è”½
- **ä¸ªäººæ•°æ®**ï¼šéƒ¨åˆ†è„±æ•

**ç« èŠ‚æ¥æº**
- [web/components/operation_logs.py](file://web/components/operation_logs.py#L972-L992)

## ä¸šåŠ¡æ—¥å¿—é…ç½®

### ç”¨æˆ·æ“ä½œå®¡è®¡

ç³»ç»Ÿè®°å½•æ‰€æœ‰ç”¨æˆ·ç›¸å…³çš„æ“ä½œï¼Œæ”¯æŒåˆè§„æ€§å’Œå®¡è®¡éœ€æ±‚ã€‚

```mermaid
graph TD
A[ç”¨æˆ·æ“ä½œ] --> B{æ“ä½œç±»å‹}
B --> |è®¤è¯| C[ç™»å½•/ç™»å‡º]
B --> |åˆ†æ| D[è‚¡ç¥¨åˆ†æ]
B --> |é…ç½®| E[ç³»ç»Ÿé…ç½®]
B --> |å¯¼å‡º| F[æ•°æ®å¯¼å‡º]
C --> C1[è®°å½•ç”¨æˆ·èº«ä»½]
D --> D1[è®°å½•åˆ†æå‚æ•°]
E --> E1[è®°å½•å˜æ›´è¯¦æƒ…]
F --> F1[è®°å½•å¯¼å‡ºå†…å®¹]
C1 --> G[æ“ä½œæ—¥å¿—]
D1 --> G
E1 --> G
F1 --> G
```

#### ä¸šåŠ¡æ—¥å¿—åŠŸèƒ½

| åŠŸèƒ½ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| log_analysis_events | true | è®°å½•åˆ†æäº‹ä»¶ |
| log_user_actions | true | è®°å½•ç”¨æˆ·æ“ä½œ |
| log_export_events | true | è®°å½•å¯¼å‡ºäº‹ä»¶ |

#### ç”¨æˆ·æ“ä½œæ—¥å¿—ç¤ºä¾‹

```
2024-01-15 10:30:45.123 | web.user_activity | INFO     | ç”¨æˆ·adminæ‰§è¡Œäº†"è‚¡ç¥¨åˆ†æ"æ“ä½œï¼Œè‚¡ç¥¨:AAPLï¼Œç±»å‹:æŠ€æœ¯åˆ†æ
```

**ç« èŠ‚æ¥æº**
- [config/logging.toml](file://config/logging.toml#L100-L105)

### æ“ä½œç±»å‹åˆ†ç±»

ç³»ç»Ÿæ”¯æŒå¤šç§æ“ä½œç±»å‹çš„è®°å½•ï¼š

- **auth**: è®¤è¯ç›¸å…³æ“ä½œ
- **analysis**: è‚¡ç¥¨åˆ†ææ“ä½œ
- **navigation**: é¡µé¢å¯¼èˆª
- **config**: ç³»ç»Ÿé…ç½®ä¿®æ”¹
- **data_export**: æ•°æ®å¯¼å‡º
- **user_management**: ç”¨æˆ·ç®¡ç†
- **system**: ç³»ç»Ÿçº§æ“ä½œ

**ç« èŠ‚æ¥æº**
- [web/components/operation_logs.py](file://web/components/operation_logs.py#L181-L221)

## æ—¥å¿—çº§åˆ«å¯¹æ€§èƒ½çš„å½±å“

### æ€§èƒ½å½±å“åˆ†æ

```mermaid
graph LR
A[æ—¥å¿—çº§åˆ«] --> B[CPUå¼€é”€]
A --> C[ç£ç›˜IO]
A --> D[å†…å­˜ä½¿ç”¨]
A --> E[ç½‘ç»œä¼ è¾“]
B --> B1[DEBUG: é«˜]
B --> B2[INFO: ä¸­ç­‰]
B --> B3[WARNING: ä½]
B --> B4[ERROR: å¾ˆä½]
B --> B5[CRITICAL: æä½]
C --> C1[DEBUG: é«˜]
C --> C2[INFO: ä¸­ç­‰]
C --> C3[WARNING: ä½]
C --> C4[ERROR: å¾ˆä½]
C --> C5[CRITICAL: æä½]
```

### æ€§èƒ½åŸºå‡†æµ‹è¯•

| æ—¥å¿—çº§åˆ« | CPUå¼€é”€ | ç£ç›˜IO | å†…å­˜ä½¿ç”¨ | æ¨èåœºæ™¯ |
|----------|---------|--------|----------|----------|
| DEBUG | 15-20% | é«˜ | ä¸­ç­‰ | å¼€å‘è°ƒè¯• |
| INFO | 5-10% | ä¸­ç­‰ | ä½ | ç”Ÿäº§ç›‘æ§ |
| WARNING | 2-5% | ä½ | å¾ˆä½ | ç”Ÿäº§ç¯å¢ƒ |
| ERROR | <2% | å¾ˆä½ | æä½ | ç¨³å®šè¿è¡Œ |
| CRITICAL | <1% | æä½ | æä½ | å…³é”®ç›‘æ§ |

### ä¼˜åŒ–å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨INFOçº§åˆ«ï¼Œé¿å…DEBUGæ—¥å¿—
2. **å¼€å‘ç¯å¢ƒ**ï¼šä½¿ç”¨DEBUGçº§åˆ«ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥
3. **Dockerç¯å¢ƒ**ï¼šå¹³è¡¡æ§åˆ¶å°å’Œæ–‡ä»¶è¾“å‡º
4. **é«˜å¹¶å‘åœºæ™¯**ï¼šè€ƒè™‘å¼‚æ­¥æ—¥å¿—å†™å…¥

**ç« èŠ‚æ¥æº**
- [tradingagents/utils/logging_manager.py](file://tradingagents/utils/logging_manager.py#L195-L228)

## å¤§æ—¥å¿—æ–‡ä»¶åˆ†å‰²ç­–ç•¥

### è½®è½¬æœºåˆ¶

ç³»ç»Ÿä½¿ç”¨Pythonæ ‡å‡†åº“çš„`RotatingFileHandler`å®ç°æ—¥å¿—è½®è½¬ã€‚

```mermaid
flowchart TD
A[æ—¥å¿—å†™å…¥] --> B{æ–‡ä»¶å¤§å°æ£€æŸ¥}
B --> |å°äºé™åˆ¶| C[ç»§ç»­å†™å…¥]
B --> |è¶…è¿‡é™åˆ¶| D[è§¦å‘è½®è½¬]
D --> E[å…³é—­å½“å‰æ–‡ä»¶]
E --> F[é‡å‘½åæ–‡ä»¶]
F --> G[åˆ›å»ºæ–°æ–‡ä»¶]
G --> H[ç»§ç»­å†™å…¥]
C --> A
H --> A
F --> I[ä¿ç•™å¤‡ä»½æ–‡ä»¶]
I --> J[åˆ é™¤è¶…å‡ºæ•°é‡çš„æ–‡ä»¶]
```

**å›¾è¡¨æ¥æº**
- [tradingagents/utils/logging_manager.py](file://tradingagents/utils/logging_manager.py#L226-L260)

### åˆ†å‰²é…ç½®

#### æ–‡ä»¶å¤§å°é™åˆ¶

| ç¯å¢ƒ | é»˜è®¤å¤§å° | æœ€å¤§å¤§å° | è¯´æ˜ |
|------|----------|----------|------|
| å¼€å‘ç¯å¢ƒ | 10MB | 50MB | ä¾¿äºè°ƒè¯• |
| ç”Ÿäº§ç¯å¢ƒ | 10MB | 100MB | æ€§èƒ½å¹³è¡¡ |
| Dockerç¯å¢ƒ | 100MB | 500MB | å®¹å™¨å­˜å‚¨ä¼˜åŒ– |

#### å¤‡ä»½æ–‡ä»¶ç­–ç•¥

- **ä¿ç•™æ•°é‡**ï¼šé»˜è®¤5ä¸ªå¤‡ä»½æ–‡ä»¶
- **å‘½åè§„åˆ™**ï¼š`filename.log.1`, `filename.log.2`, ...
- **æ¸…ç†ç­–ç•¥**ï¼šè¶…å‡ºæ•°é‡æ—¶åˆ é™¤æœ€æ—§çš„æ–‡ä»¶

### è‡ªåŠ¨æ¸…ç†æœºåˆ¶

```python
# å¤§å°è§£æå‡½æ•°
def _parse_size(self, size_str: str) -> int:
    size_str = size_str.upper()
    if size_str.endswith('KB'):
        return int(size_str[:-2]) * 1024
    elif size_str.endswith('MB'):
        return int(size_str[:-2]) * 1024 * 1024
    elif size_str.endswith('GB'):
        return int(size_str[:-2]) * 1024 * 1024 * 1024
    else:
        return int(size_str)
```

**ç« èŠ‚æ¥æº**
- [tradingagents/utils/logging_manager.py](file://tradingagents/utils/logging_manager.py#L380-L390)

### å­˜å‚¨ä¼˜åŒ–å»ºè®®

1. **å®šæœŸå½’æ¡£**ï¼šå°†å†å²æ—¥å¿—å½’æ¡£åˆ°å†·å­˜å‚¨
2. **å‹ç¼©å­˜å‚¨**ï¼šä½¿ç”¨gzipå‹ç¼©æ—§æ—¥å¿—æ–‡ä»¶
3. **äº‘å­˜å‚¨**ï¼šå°†æ—¥å¿—ä¸Šä¼ åˆ°äº‘å­˜å‚¨æœåŠ¡
4. **ç›‘æ§ç©ºé—´**ï¼šè®¾ç½®ç£ç›˜ç©ºé—´å‘Šè­¦

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜è¯Šæ–­

#### é—®é¢˜1ï¼šæ—¥å¿—æ–‡ä»¶æœªç”Ÿæˆ

**ç—‡çŠ¶**ï¼šé…ç½®äº†æ–‡ä»¶å¤„ç†å™¨ä½†æ‰¾ä¸åˆ°æ—¥å¿—æ–‡ä»¶

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥æ—¥å¿—ç›®å½•æ˜¯å¦å­˜åœ¨
2. éªŒè¯ç›®å½•å†™å…¥æƒé™
3. ç¡®è®¤å¤„ç†å™¨å·²å¯ç”¨
4. æ£€æŸ¥æ—¥å¿—çº§åˆ«è®¾ç½®

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ç›®å½•æƒé™
ls -la logs/
chmod 755 logs/

# æ‰‹åŠ¨åˆ›å»ºç›®å½•
mkdir -p logs/
```

**ç« èŠ‚æ¥æº**
- [scripts/test_docker_logging.py](file://scripts/test_docker_logging.py#L30-L60)

#### é—®é¢˜2ï¼šDockerç¯å¢ƒæ—¥å¿—ä¸¢å¤±

**ç—‡çŠ¶**ï¼šDockerå®¹å™¨ä¸­æ²¡æœ‰æ—¥å¿—è¾“å‡º

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥`DOCKER_CONTAINER`ç¯å¢ƒå˜é‡
2. éªŒè¯æ—¥å¿—é…ç½®ä¸­çš„Dockerè®¾ç½®
3. ç¡®è®¤å®¹å™¨æŒ‚è½½ç‚¹

**è§£å†³æ–¹æ¡ˆ**ï¼š
```yaml
# docker-compose.yml
environment:
  - DOCKER_CONTAINER=true
  - TRADINGAGENTS_LOG_DIR=/app/logs
```

**ç« èŠ‚æ¥æº**
- [scripts/fix_docker_logging.py](file://scripts/fix_docker_logging.py#L115-L162)

#### é—®é¢˜3ï¼šæ—¥å¿—æ ¼å¼å¼‚å¸¸

**ç—‡çŠ¶**ï¼šæ—¥å¿—è¾“å‡ºæ ¼å¼ä¸æ­£ç¡®æˆ–ç¼ºå°‘ä¿¡æ¯

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥æ ¼å¼æ¨¡æ¿è¯­æ³•
2. éªŒè¯å¤„ç†å™¨é…ç½®
3. ç¡®è®¤æ¨¡å—å¯¼å…¥é¡ºåº

**ç« èŠ‚æ¥æº**
- [tradingagents/utils/logging_manager.py](file://tradingagents/utils/logging_manager.py#L42-L88)

### è°ƒè¯•å·¥å…·

#### æ—¥å¿—æµ‹è¯•è„šæœ¬

ç³»ç»Ÿæä¾›äº†ä¸“é—¨çš„æµ‹è¯•è„šæœ¬æ¥éªŒè¯æ—¥å¿—é…ç½®ï¼š

```python
# æµ‹è¯•æ—¥å¿—åŠŸèƒ½
def test_logging():
    """æµ‹è¯•æ—¥å¿—åŠŸèƒ½"""
    # è®¾ç½®Dockerç¯å¢ƒå˜é‡
    os.environ['DOCKER_CONTAINER'] = 'true'
    os.environ['TRADINGAGENTS_LOG_DIR'] = '/app/logs'
    
    # åˆå§‹åŒ–æ—¥å¿—
    init_logging()
    
    # æµ‹è¯•å„ç§çº§åˆ«çš„æ—¥å¿—
    logger.debug("DEBUGçº§åˆ«æ—¥å¿—")
    logger.info("INFOçº§åˆ«æ—¥å¿—")
    logger.warning("WARNINGçº§åˆ«æ—¥å¿—")
    logger.error("ERRORçº§åˆ«æ—¥å¿—")
```

**ç« èŠ‚æ¥æº**
- [scripts/test_docker_logging.py](file://scripts/test_docker_logging.py#L15-L60)

#### é…ç½®ä¿®å¤å·¥å…·

ç³»ç»Ÿæä¾›äº†è‡ªåŠ¨ä¿®å¤å·¥å…·æ¥è§£å†³å¸¸è§é…ç½®é—®é¢˜ï¼š

```bash
# è¿è¡Œä¿®å¤å·¥å…·
python scripts/fix_docker_logging.py
```

**ç« èŠ‚æ¥æº**
- [scripts/fix_docker_logging.py](file://scripts/fix_docker_logging.py#L10-L45)

## æœ€ä½³å®è·µ

### é…ç½®æœ€ä½³å®è·µ

#### 1. ç¯å¢ƒåˆ†ç¦»é…ç½®

```toml
# å¼€å‘ç¯å¢ƒ
[logging]
level = "DEBUG"

[logging.docker]
enabled = false

# ç”Ÿäº§ç¯å¢ƒ
[logging]
level = "INFO"

[logging.docker]
enabled = true
stdout_only = false
```

#### 2. æ¨¡å—åŒ–æ—¥å¿—å™¨é…ç½®

```toml
[logging.loggers.tradingagents]
level = "INFO"

[logging.loggers.web]
level = "INFO"

[logging.loggers.dataflows]
level = "DEBUG"  # æ•°æ®æµéœ€è¦è¯¦ç»†æ—¥å¿—

[logging.loggers.llm_adapters]
level = "WARNING"  # LLMè°ƒç”¨é¢‘ç¹ï¼Œå‡å°‘å™ªéŸ³
```

#### 3. æ€§èƒ½ä¼˜åŒ–é…ç½®

```toml
[logging.performance]
enabled = true
log_slow_operations = true
slow_threshold_seconds = 5.0

[logging.handlers.file]
max_size = "10MB"
backup_count = 5
```

### å®‰å…¨æœ€ä½³å®è·µ

#### 1. æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

- å§‹ç»ˆå¯ç”¨`mask_sensitive_data`
- å®šæœŸå®¡æŸ¥æ—¥å¿—å†…å®¹
- ä½¿ç”¨é€‚å½“çš„æ—¥å¿—çº§åˆ«

#### 2. è®¿é—®æ§åˆ¶

- é™åˆ¶æ—¥å¿—æ–‡ä»¶è®¿é—®æƒé™
- ä½¿ç”¨ä¸“ç”¨æ—¥å¿—ç”¨æˆ·
- å®šæœŸè½®è½¬å’Œæ¸…ç†

#### 3. ç›‘æ§å‘Šè­¦

```toml
[logging.security]
log_api_calls = true
log_token_usage = true
mask_sensitive_data = true
```

### è¿ç»´æœ€ä½³å®è·µ

#### 1. æ—¥å¿—æ”¶é›†ç­–ç•¥

```bash
# æ”¶é›†æ‰€æœ‰æ—¥å¿—æ–‡ä»¶
find logs/ -name "*.log*" -exec cat {} \;

# æŒ‰æ—¶é—´è¿‡æ»¤
grep "2024-01-15" logs/tradingagents.log;

# æŒ‰çº§åˆ«è¿‡æ»¤
grep -i "error\|critical" logs/tradingagents.log;
```

#### 2. æ€§èƒ½ç›‘æ§

```bash
# ç›‘æ§æ—¥å¿—æ–‡ä»¶å¤§å°
du -sh logs/

# ç›‘æ§ç£ç›˜ä½¿ç”¨
df -h logs/

# ç›‘æ§æ—¥å¿—å†™å…¥é¢‘ç‡
tail -f logs/tradingagents.log | wc -l
```

#### 3. å¤‡ä»½ç­–ç•¥

```bash
# åˆ›å»ºæ—¥å¿—å¤‡ä»½
tar -czf logs_backup_$(date +%Y%m%d).tar.gz logs/

# å½’æ¡£å†å²æ—¥å¿—
mv logs/*_old_* logs/archive/
```

### å¼€å‘æœ€ä½³å®è·µ

#### 1. æ—¥å¿—è®°å½•è§„èŒƒ

```python
# å¥½çš„ç¤ºä¾‹
logger.info(f"è‚¡ç¥¨åˆ†æå®Œæˆ - è‚¡ç¥¨: {stock_code}, è€—æ—¶: {duration:.2f}s")
logger.error(f"APIè°ƒç”¨å¤±è´¥ - URL: {url}, é”™è¯¯: {error}")

# é¿å…çš„ç¤ºä¾‹
logger.info("æˆåŠŸ")  # å¤ªæ¨¡ç³Š
logger.error("å‡ºé”™äº†")  # ç¼ºå°‘ä¸Šä¸‹æ–‡
```

#### 2. ç»“æ„åŒ–æ—¥å¿—

```python
# ä½¿ç”¨é¢å¤–å­—æ®µ
logger.info(
    "åˆ†æå®Œæˆ",
    extra={
        'stock_symbol': stock_code,
        'analysis_type': analysis_type,
        'duration': duration,
        'cost': cost
    }
)
```

#### 3. å¼‚å¸¸å¤„ç†

```python
try:
    # ä¸šåŠ¡é€»è¾‘
    pass
except Exception as e:
    logger.error(
        f"æ“ä½œå¤±è´¥: {str(e)}",
        extra={'error_type': type(e).__name__},
        exc_info=True
    )
```

### éƒ¨ç½²æœ€ä½³å®è·µ

#### 1. Dockeréƒ¨ç½²

```yaml
# docker-compose.yml
services:
  tradingagents:
    image: tradingagents:latest
    environment:
      - DOCKER_CONTAINER=true
      - TRADINGAGENTS_LOG_DIR=/app/logs
    volumes:
      - ./logs:/app/logs
```

#### 2. Kuberneteséƒ¨ç½²

```yaml
# pod.spec
spec:
  containers:
  - name: tradingagents
    env:
    - name: DOCKER_CONTAINER
      value: "true"
    volumeMounts:
    - name: logs
      mountPath: /app/logs
  volumes:
  - name: logs
    emptyDir: {}
```

#### 3. ç›‘æ§é›†æˆ

```yaml
# Prometheusé…ç½®
scrape_configs:
  - job_name: 'tradingagents'
    static_configs:
      - targets: ['localhost:8080']
    metrics_path: /metrics
    scrape_interval: 15s
```

é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œå¯ä»¥ç¡®ä¿TradingAgents-CNçš„æ—¥å¿—ç³»ç»Ÿæ—¢é«˜æ•ˆåˆå¯é ï¼Œä¸ºç³»ç»Ÿçš„è¿ç»´å’Œå¼€å‘æä¾›å¼ºæœ‰åŠ›çš„æ”¯æŒã€‚