
# 扩展开发

<cite>
**本文档中引用的文件**   
- [openai_compatible_base.py](file://tradingagents/llm_adapters/openai_compatible_base.py)
- [data_source_manager.py](file://tradingagents/dataflows/data_source_manager.py)
- [trading_graph.py](file://tradingagents/graph/trading_graph.py)
- [demo_deepseek_analysis.py](file://examples/demo_deepseek_analysis.py)
- [tushare_demo.py](file://examples/tushare_demo.py)
- [simple_analysis_demo.py](file://examples/simple_analysis_demo.py)
- [batch_analysis.py](file://examples/batch_analysis.py)
- [config_management_demo.py](file://examples/config_management_demo.py)
- [token_tracking_demo.py](file://examples/token_tracking_demo.py)
</cite>

## 目录
1. [简介](#简介)
2. [添加新的LLM适配器](#添加新的llm适配器)
3. [集成新的数据源](#集成新的数据源)
4. [创建新的智能体类型](#创建新的智能体类型)
5. [示例程序解读](#示例程序解读)
6. [代码规范与贡献流程](#代码规范与贡献流程)

## 简介
本指南旨在为开发者提供详细的扩展开发指导，帮助定制和增强TradingAgents-CN的功能。通过本指南，开发者将学习如何添加新的LLM适配器、集成新的金融数据API、创建新的智能体类型，并利用示例程序作为参考模板。同时，本指南强调了代码规范、测试要求和贡献流程的重要性。

## 添加新的LLM适配器
要添加新的LLM适配器，开发者需要继承`OpenAICompatibleBase`基类，并实现必要的抽象方法。`OpenAICompatibleBase`类位于`tradingagents/llm_adapters/openai_compatible_base.py`，为所有支持OpenAI接口的LLM提供商提供统一的基础实现。

### 继承OpenAICompatibleBase基类
`OpenAICompatibleBase`类提供了初始化、生成聊天响应和记录token使用量的基本功能。开发者需要创建一个新的适配器类，继承自`OpenAICompatibleBase`，并根据具体LLM提供商的API进行定制。

### 实现必要的抽象方法
在继承`OpenAICompatibleBase`后，开发者需要实现以下方法：
- `__init__`：初始化适配器，设置提供商名称、模型名称、API密钥环境变量名、API基础URL等参数。
- `_generate`：生成聊天响应，并记录token使用量。
- `_track_token_usage`：追踪token使用量，计算成本并输出使用统计。

### 注册到适配器工厂
新的适配器需要在`OPENAI_COMPATIBLE_PROVIDERS`字典中注册，以便通过工厂函数`create_open