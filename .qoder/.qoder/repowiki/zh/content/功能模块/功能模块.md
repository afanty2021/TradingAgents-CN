
# åŠŸèƒ½æ¨¡å—

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**   
- [fundamentals_analyst.py](file://tradingagents/agents/analysts/fundamentals_analyst.py)
- [market_analyst.py](file://tradingagents/agents/analysts/market_analyst.py)
- [news_analyst.py](file://tradingagents/agents/analysts/news_analyst.py)
- [social_media_analyst.py](file://tradingagents/agents/analysts/social_media_analyst.py)
- [bull_researcher.py](file://tradingagents/agents/researchers/bull_researcher.py)
- [bear_researcher.py](file://tradingagents/agents/researchers/bear_researcher.py)
- [research_manager.py](file://tradingagents/agents/managers/research_manager.py)
- [trader.py](file://tradingagents/agents/trader/trader.py)
- [aggresive_debator.py](file://tradingagents/agents/risk_mgmt/aggresive_debator.py)
- [conservative_debator.py](file://tradingagents/agents/risk_mgmt/conservative_debator.py)
- [neutral_debator.py](file://tradingagents/agents/risk_mgmt/neutral_debator.py)
- [trading_graph.py](file://tradingagents/graph/trading_graph.py)
</cite>

## ç›®å½•
1. [åˆ†æå¸ˆå›¢é˜Ÿ](#åˆ†æå¸ˆå›¢é˜Ÿ)
2. [ç ”ç©¶å›¢é˜Ÿ](#ç ”ç©¶å›¢é˜Ÿ)
3. [äº¤æ˜“å›¢é˜Ÿ](#äº¤æ˜“å›¢é˜Ÿ)
4. [é£é™©ç®¡ç†å›¢é˜Ÿ](#é£é™©ç®¡ç†å›¢é˜Ÿ)
5. [æ™ºèƒ½ä½“åä½œæµç¨‹](#æ™ºèƒ½ä½“åä½œæµç¨‹)
6. [è¾©è®ºæœºåˆ¶](#è¾©è®ºæœºåˆ¶)
7. [æ¡ˆä¾‹åˆ†æ](#æ¡ˆä¾‹åˆ†æ)

## åˆ†æå¸ˆå›¢é˜Ÿ

### åŸºæœ¬é¢åˆ†æå¸ˆ
```python
class FundamentalsAnalyst(BaseAnalyst):
    """åŸºæœ¬é¢åˆ†æå¸ˆ - ä¸“æ³¨äºå…¬å¸è´¢åŠ¡å’ŒåŸºæœ¬é¢åˆ†æ"""
    
    ä¸“ä¸šé¢†åŸŸ:
    - è´¢åŠ¡æŠ¥è¡¨åˆ†æ
    - ä¼°å€¼æ¨¡å‹è®¡ç®—
    - è¡Œä¸šå¯¹æ¯”åˆ†æ
    - ç›ˆåˆ©èƒ½åŠ›è¯„ä¼°
    - è´¢åŠ¡å¥åº·åº¦è¯„ä¼°
    
    åˆ†æç»´åº¦:
    - æ”¶å…¥å¢é•¿ç‡
    - åˆ©æ¶¦ç‡è¶‹åŠ¿
    - èµ„äº§è´Ÿå€ºæ¯”ç‡
    - ç°é‡‘æµçŠ¶å†µ
    - ROE/ROA æŒ‡æ ‡
    - P/E, P/B ä¼°å€¼æ¯”ç‡
```

#### è¾“å…¥è¾“å‡º
- **è¾“å…¥æ•°æ®**: è´¢åŠ¡æŠ¥è¡¨æ•°æ®ã€è¡Œä¸šæ•°æ®ã€å®è§‚ç»æµæŒ‡æ ‡
- **è¾“å‡ºç»“æœ**: åŸºæœ¬é¢è¯„åˆ†ã€ä¼°å€¼å»ºè®®ã€è´¢åŠ¡å¥åº·åº¦è¯„ä¼°

#### å†…éƒ¨é€»è¾‘
```python
def perform_analysis(self, data: Dict) -> Dict:
    """æ‰§è¡ŒåŸºæœ¬é¢åˆ†æ"""
    
    financial_data = data.get("financial_data", {})
    company_info = data.get("company_info", {})
    
    analysis = {
        "financial_health": self._assess_financial_health(financial_data),
        "valuation": self._calculate_valuation(financial_data),
        "growth_analysis": self._analyze_growth(financial_data),
        "profitability": self._assess_profitability(financial_data),
        "liquidity": self._assess_liquidity(financial_data),
        "leverage": self._assess_leverage(financial_data)
    }
    
    # ç»¼åˆè¯„åˆ†
    analysis["overall_score"] = self._calculate_overall_score(analysis)
    analysis["recommendation"] = self._generate_recommendation(analysis)
    
    return analysis
```

**èŠ‚æ¥æº**
- [fundamentals_analyst.py](file://tradingagents/agents/analysts/fundamentals_analyst.py#L50-L139)

### æŠ€æœ¯åˆ†æå¸ˆ
```python
class MarketAnalyst(BaseAnalyst):
    """æŠ€æœ¯åˆ†æå¸ˆ - ä¸“æ³¨äºæŠ€æœ¯æŒ‡æ ‡å’Œä»·æ ¼è¶‹åŠ¿åˆ†æ"""
    
    ä¸“ä¸šé¢†åŸŸ:
    - æŠ€æœ¯æŒ‡æ ‡è®¡ç®—
    - è¶‹åŠ¿è¯†åˆ«
    - æ”¯æ’‘é˜»åŠ›ä½åˆ†æ
    - äº¤æ˜“ä¿¡å·ç”Ÿæˆ
    - å¸‚åœºæƒ…ç»ªåˆ†æ
    
    æŠ€æœ¯æŒ‡æ ‡:
    - ç§»åŠ¨å¹³å‡çº¿ (MA, EMA)
    - ç›¸å¯¹å¼ºå¼±æŒ‡æ•° (RSI)
    - MACD æŒ‡æ ‡
    - å¸ƒæ—å¸¦ (Bollinger Bands)
    - æˆäº¤é‡æŒ‡æ ‡
    - åŠ¨é‡æŒ‡æ ‡
```

#### è¾“å…¥è¾“å‡º
- **è¾“å…¥æ•°æ®**: å†å²ä»·æ ¼æ•°æ®ã€äº¤æ˜“é‡æ•°æ®ã€æŠ€æœ¯æŒ‡æ ‡æ•°æ®
- **è¾“å‡ºç»“æœ**: æŠ€æœ¯åˆ†æè¯„åˆ†ã€è¶‹åŠ¿æ–¹å‘åˆ¤æ–­ã€å…³é”®ä»·ä½è¯†åˆ«

#### å†…éƒ¨é€»è¾‘
```python
def perform_analysis(self, data: Dict) -> Dict:
    """æ‰§è¡ŒæŠ€æœ¯åˆ†æ"""
    
    price_data = data.get("price_data", {})
    volume_data = data.get("volume_data", {})
    
    # è®¡ç®—æŠ€æœ¯æŒ‡æ ‡
    indicators = self._calculate_indicators(price_data, volume_data)
    
    # è¶‹åŠ¿åˆ†æ
    trend_analysis = self._analyze_trend(price_data, indicators)
    
    # æ”¯æ’‘é˜»åŠ›ä½
    support_resistance = self._find_support_resistance(price_data)
    
    # äº¤æ˜“ä¿¡å·
    signals = self._generate_signals(indicators, trend_analysis)
    
    analysis = {
        "indicators": indicators,
        "trend": trend_analysis,
        "support_resistance": support_resistance,
        "signals": signals,
        "momentum": self._assess_momentum(indicators),
        "volatility": self._assess_volatility(price_data)
    }
    
    # ç»¼åˆæŠ€æœ¯è¯„åˆ†
    analysis["technical_score"] = self._calculate_technical_score(analysis)
    analysis["recommendation"] = self._generate_technical_recommendation(analysis)
    
    return analysis
```

**èŠ‚æ¥æº**
- [market_analyst.py](file://tradingagents/agents/analysts/market_analyst.py#L140-L258)

### æ–°é—»åˆ†æå¸ˆ
```python
class NewsAnalyst(BaseAnalyst):
    """æ–°é—»åˆ†æå¸ˆ - ä¸“æ³¨äºæ–°é—»äº‹ä»¶å’Œå®è§‚å› ç´ åˆ†æ"""
    
    ä¸“ä¸šé¢†åŸŸ:
    - æ–°é—»æƒ…æ„Ÿåˆ†æ
    - äº‹ä»¶å½±å“è¯„ä¼°
    - å®è§‚ç»æµåˆ†æ
    - æ”¿ç­–å½±å“åˆ†æ
    - è¡Œä¸šåŠ¨æ€åˆ†æ
    
    åˆ†æç»´åº¦:
    - æ–°é—»æƒ…æ„Ÿææ€§
    - äº‹ä»¶é‡è¦æ€§è¯„çº§
    - å½±å“æ—¶é—´èŒƒå›´
    - å¸‚åœºååº”é¢„æœŸ
    - é£é™©å› ç´ è¯†åˆ«
```

#### è¾“å…¥è¾“å‡º
- **è¾“å…¥æ•°æ®**: æ–°é—»æ–‡ç« ã€ç»æµæ•°æ®å‘å¸ƒã€æ”¿ç­–å…¬å‘Š
- **è¾“å‡ºç»“æœ**: æ–°é—»æƒ…æ„Ÿè¯„åˆ†ã€äº‹ä»¶å½±å“è¯„ä¼°ã€å®è§‚è¶‹åŠ¿åˆ¤æ–­

#### å†…éƒ¨é€»è¾‘
```python
def perform_analysis(self, data: Dict) -> Dict:
    """æ‰§è¡Œæ–°é—»åˆ†æ"""
    
    news_data = data.get("news_data", [])
    economic_data = data.get("economic_data", {})
    
    analysis = {
        "sentiment_analysis": self._analyze_sentiment(news_data),
        "event_impact": self._assess_event_impact(news_data),
        "macro_analysis": self._analyze_macro_factors(economic_data),
        "risk_factors": self._identify_risk_factors(news_data),
        "catalysts": self._identify_catalysts(news_data)
    }
    
    # ç»¼åˆæ–°é—»è¯„åˆ†
    analysis["news_score"] = self._calculate_news_score(analysis)
    analysis["market_impact"] = self._assess_market_impact(analysis)
    
    return analysis
```

**èŠ‚æ¥æº**
- [news_analyst.py](file://tradingagents/agents/analysts/news_analyst.py#L259-L366)

### ç¤¾äº¤åª’ä½“åˆ†æå¸ˆ
```python
class SocialMediaAnalyst(BaseAnalyst):
    """ç¤¾äº¤åª’ä½“åˆ†æå¸ˆ - ä¸“æ³¨äºç¤¾äº¤åª’ä½“æƒ…ç»ªå’Œèˆ†è®ºåˆ†æ"""
    
    ä¸“ä¸šé¢†åŸŸ:
    - ç¤¾äº¤åª’ä½“æƒ…æ„Ÿåˆ†æ
    - èˆ†è®ºè¶‹åŠ¿ç›‘æµ‹
    - çƒ­ç‚¹è¯é¢˜è¯†åˆ«
    - æŠ•èµ„è€…æƒ…ç»ªè¯„ä¼°
    - ç—…æ¯’å¼ä¼ æ’­åˆ†æ
    
    æ•°æ®æº:
    - Reddit è®¨è®º
    - Twitter æƒ…æ„Ÿ
    - æŠ•èµ„è®ºå›
    - æ–°é—»è¯„è®º
    - ç¤¾äº¤åª’ä½“æåŠ
```

#### è¾“å…¥è¾“å‡º
- **è¾“å…¥æ•°æ®**: Reddit è®¨è®ºæ•°æ®ã€Twitter æƒ…æ„Ÿæ•°æ®ã€è®ºå›è®¨è®ºå†…å®¹
- **è¾“å‡ºç»“æœ**: ç¤¾äº¤æƒ…æ„Ÿè¯„åˆ†ã€èˆ†è®ºè¶‹åŠ¿åˆ†æã€æŠ•èµ„è€…æƒ…ç»ªæŒ‡æ ‡

#### å†…éƒ¨é€»è¾‘
```python
def perform_analysis(self, data: Dict) -> Dict:
    """æ‰§è¡Œç¤¾äº¤åª’ä½“åˆ†æ"""
    
    social_data = data.get("social_data", {})
    
    analysis = {
        "sentiment_trends": self._analyze_sentiment_trends(social_data),
        "discussion_volume": self._analyze_discussion_volume(social_data),
        "key_topics": self._extract_key_topics(social_data),
        "influencer_sentiment": self._analyze_influencer_sentiment(social_data),
        "viral_content": self._identify_viral_content(social_data)
    }
    
    # ç»¼åˆç¤¾äº¤åª’ä½“è¯„åˆ†
    analysis["social_score"] = self._calculate_social_score(analysis)
    analysis["crowd_sentiment"] = self._assess_crowd_sentiment(analysis)
    
    return analysis
```

**èŠ‚æ¥æº**
- [social_media_analyst.py](file://tradingagents/agents/analysts/social_media_analyst.py#L367-L429)

## ç ”ç©¶å›¢é˜Ÿ

### çœ‹æ¶¨ç ”ç©¶å‘˜
```python
class BullResearcher(BaseResearcher):
    """çœ‹æ¶¨ç ”ç©¶å‘˜ - ä»ä¹è§‚è§’åº¦è¯„ä¼°æŠ•èµ„æœºä¼š"""
    
    def __init__(self, llm, config):
        super().__init__(llm, config, stance="bullish")
        
    ä¸“ä¸šç‰¹ç‚¹:
    - ç§¯æå¯»æ‰¾å¢é•¿æœºä¼š
    - å¼ºè°ƒæ­£é¢å‚¬åŒ–å‰‚
    - å…³æ³¨ä¸Šæ¶¨æ½œåŠ›
    - æŒ‘æˆ˜æ‚²è§‚è§‚ç‚¹
    
    åˆ†æé‡ç‚¹:
    - æ”¶å…¥å¢é•¿é©±åŠ¨å› ç´ 
    - å¸‚åœºæ‰©å¼ æœºä¼š
    - ç«äº‰ä¼˜åŠ¿åˆ†æ
    - ä¼°å€¼å¸å¼•åŠ›
    - æŠ€æœ¯åˆ›æ–°æ½œåŠ›
    - ç®¡ç†å±‚æ‰§è¡ŒåŠ›
```

#### è¾“å…¥è¾“å‡º
- **è¾“å…¥æ•°æ®**: å„åˆ†æå¸ˆçš„åˆ†ææŠ¥å‘Šã€å¸‚åœºæ•°æ®
- **è¾“å‡ºç»“æœ**: çœ‹æ¶¨è®ºç‚¹ã€å¢é•¿æœºä¼šè¯†åˆ«ã€æ­£é¢å‚¬åŒ–å‰‚åˆ†æ

#### å†…éƒ¨é€»è¾‘
```python
def analyze_from_stance(self, interpretation: Dict) -> Dict:
    """ä»çœ‹æ¶¨è§’åº¦åˆ†æ"""
    
    bullish_factors = []
    growth_opportunities = []
    positive_catalysts = []
    
    # åŸºæœ¬é¢çœ‹æ¶¨å› ç´ 
    fundamental_data = interpretation.get("fundamental_analysis", {})
    if fundamental_data.get("revenue_growth", 0) > 0.1:  # 10%ä»¥ä¸Šå¢é•¿
        bullish_factors.append("å¼ºåŠ²çš„æ”¶å…¥å¢é•¿")
    
    if fundamental_data.get("profit_margin_trend") == "improving":
        bullish_factors.append("åˆ©æ¶¦ç‡æ”¹å–„è¶‹åŠ¿")
    
    # æŠ€æœ¯é¢çœ‹æ¶¨ä¿¡å·
    technical_data = interpretation.get("technical_analysis", {})
    if technical_data.get("trend_direction") == "uptrend":
        bullish_factors.append("æŠ€æœ¯é¢ä¸Šå‡è¶‹åŠ¿")
    
    if technical_data.get("momentum") == "positive":
        bullish_factors.append("æ­£é¢åŠ¨é‡ä¿¡å·")
    
    # æ–°é—»é¢ç§¯æå› ç´ 
    news_data = interpretation.get("news_analysis", {})
    if news_data.get("sentiment_score", 0) > 0.6:
        positive_catalysts.append("ç§¯æçš„æ–°é—»æƒ…ç»ª")
    
    # è¯†åˆ«å¢é•¿æœºä¼š
    growth_opportunities = self._identify_growth_opportunities(interpretation)
    
    return {
        "bullish_factors": bullish_factors,
        "growth_opportunities": growth_opportunities,
        "positive_catalysts": positive_catalysts,
        "upside_potential": self._calculate_upside_potential(interpretation),
        "risk_mitigation": self._identify_risk_mitigation_factors(interpretation)
    }
```

**èŠ‚æ¥æº**
- [bull_researcher.py](file://tradingagents/agents/researchers/bull_researcher.py#L71-L223)

### çœ‹è·Œç ”ç©¶å‘˜
```python
class BearResearcher(BaseResearcher):
    """çœ‹è·Œç ”ç©¶å‘˜ - ä»æ‚²è§‚è§’åº¦è¯„ä¼°æŠ•èµ„é£é™©"""
    
    def __init__(self, llm, config):
        super().__init__(llm, config, stance="bearish")
        
    ä¸“ä¸šç‰¹ç‚¹:
    - ä¸“æ³¨é£é™©è¯†åˆ«
    - è´¨ç–‘ä¹è§‚å‡è®¾
    - å…³æ³¨ä¸‹è·Œé£é™©
    - æŒ‘æˆ˜çœ‹æ¶¨è§‚ç‚¹
    
    åˆ†æé‡ç‚¹:
    - æ½œåœ¨é£é™©å› ç´ 
    - ä¼°å€¼è¿‡é«˜é£é™©
    - ç«äº‰å¨èƒåˆ†æ
    - å®è§‚ç»æµé£é™©
    - è¡Œä¸šå‘¨æœŸæ€§é£é™©
    - å…¬å¸æ²»ç†é—®é¢˜
```

#### è¾“å…¥è¾“å‡º
- **è¾“å…¥æ•°æ®**: å„åˆ†æå¸ˆçš„åˆ†ææŠ¥å‘Šã€å¸‚åœºæ•°æ®
- **è¾“å‡ºç»“æœ**: çœ‹è·Œè®ºç‚¹ã€é£é™©å› ç´ è¯†åˆ«ã€è´Ÿé¢å‚¬åŒ–å‰‚åˆ†æ

#### å†…éƒ¨é€»è¾‘
```python
def analyze_from_stance(self, interpretation: Dict) -> Dict:
    """ä»çœ‹è·Œè§’åº¦åˆ†æ"""
    
    bearish_factors = []
    risk_factors = []
    negative_catalysts = []
    
    # åŸºæœ¬é¢é£é™©å› ç´ 
    fundamental_data = interpretation.get("fundamental_analysis", {})
    if fundamental_data.get("debt_to_equity", 0) > 0.6:
        bearish_factors.append("é«˜è´Ÿå€ºæ¯”ç‡é£é™©")
    
    if fundamental_data.get("profit_margin_trend") == "declining":
        bearish_factors.append("åˆ©æ¶¦ç‡ä¸‹é™è¶‹åŠ¿")
    
    # æŠ€æœ¯é¢çœ‹è·Œä¿¡å·
    technical_data = interpretation.get("technical_analysis", {})
    if technical_data.get("trend_direction") == "downtrend":
        bearish_factors.append("æŠ€æœ¯é¢ä¸‹é™è¶‹åŠ¿")
    
    if technical_data.get("volume_trend") == "declining":
        bearish_factors.append("æˆäº¤é‡èç¼©ä¿¡å·")
    
    # æ–°é—»é¢è´Ÿé¢å› ç´ 
    news_data = interpretation.get("news_analysis", {})
    if news_data.get("sentiment_score", 0) < 0.4:
        negative_catalysts.append("è´Ÿé¢æ–°é—»æƒ…ç»ª")
    
    # è¯†åˆ«é£é™©å› ç´ 
    risk_factors = self._identify_risk_factors(interpretation)
    
    return {
        "bearish_factors": bearish_factors,
        "risk_factors": risk_factors,
        "negative_catalysts": negative_catalysts,
        "downside_potential": self._calculate_downside_potential(interpretation),
        "valuation_concerns": self._assess_valuation_risks(interpretation)
    }
```

**èŠ‚æ¥æº**
- [bear_researcher.py](file://tradingagents/agents/researchers/bear_researcher.py#L224-L376)

## äº¤æ˜“å›¢é˜Ÿ

### äº¤æ˜“å‘˜
```python
class Trader(BaseAgent):
    """äº¤æ˜“å‘˜ - åˆ¶å®šæœ€ç»ˆäº¤æ˜“å†³ç­–"""
    
    èŒè´£:
    - ç»¼åˆå„æ–¹åˆ†æ
    - åˆ¶å®šäº¤æ˜“ç­–ç•¥
    - ç¡®å®šä»“ä½å¤§å°
    - è®¾ç½®æ­¢æŸæ­¢ç›ˆ
    
    å†³ç­–å› ç´ :
    - åˆ†æå¸ˆæŠ¥å‘Š
    - ç ”ç©¶å‘˜è¾©è®ºç»“æœ
    - é£é™©è¯„ä¼°
    - å¸‚åœºæ¡ä»¶
```

#### è¾“å…¥è¾“å‡º
- **è¾“å…¥æ•°æ®**: åˆ†æå¸ˆæŠ¥å‘Šã€ç ”ç©¶å‘˜è¾©è®ºç»“æœã€é£é™©è¯„ä¼°
- **è¾“å‡ºç»“æœ**: æœ€ç»ˆäº¤æ˜“å†³ç­–ã€ä»“ä½å¤§å°ã€æ­¢æŸæ­¢ç›ˆè®¾ç½®

#### å†…éƒ¨é€»è¾‘
```python
def trader_node(state, name):
    company_name = state["company_of_interest"]
    investment_plan = state["investment_plan"]
    market_research_report = state["market_report"]
    sentiment_report = state["sentiment_report"]
    news_report = state["news_report"]
    fundamentals_report = state["fundamentals_report"]

    # æ£€æŸ¥æ˜¯å¦ä¸ºä¸­å›½è‚¡ç¥¨
    def is_china_stock(ticker_code):
        import re
        return re.match(r'^\d{6}$', str(ticker_code))

    # æ ¹æ®è‚¡ç¥¨ç±»å‹ç¡®å®šè´§å¸å•ä½
    is_china = is_china_stock(company_name)
    currency = "äººæ°‘å¸" if is_china else "ç¾å…ƒ"
    currency_symbol = "Â¥" if is_china else "$"

    curr_situation = f"{market_research_report}\n\n{sentiment_report}\n\n{news_report}\n\n{fundamentals_report}"
    past_memories = memory.get_memories(curr_situation, n_matches=2)

    context = {
        "role": "user",
        "content": f"Based on a comprehensive analysis by a team of analysts, here is an investment plan tailored for {company_name}. This plan incorporates insights from current technical market trends, macroeconomic indicators, and social media sentiment. Use this plan as a foundation for evaluating your next trading decision.\n\nProposed Investment Plan: {investment_plan}\n\nLeverage these insights to make an informed and strategic decision.",
    }

    messages = [
        {
            "role": "system",
            "content": f"""æ‚¨æ˜¯ä¸€ä½ä¸“ä¸šçš„äº¤æ˜“å‘˜ï¼Œè´Ÿè´£åˆ†æå¸‚åœºæ•°æ®å¹¶åšå‡ºæŠ•èµ„å†³ç­–ã€‚åŸºäºæ‚¨çš„åˆ†æï¼Œè¯·æä¾›å…·ä½“çš„ä¹°å…¥ã€å–å‡ºæˆ–æŒæœ‰å»ºè®®ã€‚

âš ï¸ é‡è¦æé†’ï¼šå½“å‰åˆ†æçš„è‚¡ç¥¨ä»£ç æ˜¯ {company_name}ï¼Œè¯·ä½¿ç”¨æ­£ç¡®çš„è´§å¸å•ä½ï¼š{currency}ï¼ˆ{currency_symbol}ï¼‰

ğŸ”´ ä¸¥æ ¼è¦æ±‚ï¼š
- è‚¡ç¥¨ä»£ç  {company_name} çš„å…¬å¸åç§°å¿…é¡»ä¸¥æ ¼æŒ‰ç…§åŸºæœ¬é¢æŠ¥å‘Šä¸­çš„çœŸå®æ•°æ®
- ç»å¯¹ç¦æ­¢ä½¿ç”¨é”™è¯¯çš„å…¬å¸åç§°æˆ–æ··æ·†ä¸åŒçš„è‚¡ç¥¨
- æ‰€æœ‰åˆ†æå¿…é¡»åŸºäºæä¾›çš„çœŸå®æ•°æ®ï¼Œä¸å…è®¸å‡è®¾æˆ–ç¼–é€ 
- **å¿…é¡»æä¾›å…·ä½“çš„ç›®æ ‡ä»·ä½ï¼Œä¸å…è®¸è®¾ç½®ä¸ºnullæˆ–ç©ºå€¼**

è¯·åœ¨æ‚¨çš„åˆ†æä¸­åŒ…å«ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š
1. **æŠ•èµ„å»ºè®®**: æ˜ç¡®çš„ä¹°å…¥/æŒæœ‰/å–å‡ºå†³ç­–
2. **ç›®æ ‡ä»·ä½**: åŸºäºåˆ†æçš„åˆç†ç›®æ ‡ä»·æ ¼({currency}) - ğŸš¨ å¼ºåˆ¶è¦æ±‚æä¾›å…·ä½“æ•°å€¼
   - ä¹°å…¥å»ºè®®ï¼šæä¾›ç›®æ ‡ä»·ä½å’Œé¢„æœŸæ¶¨å¹…
   - æŒæœ‰å»ºè®®ï¼šæä¾›åˆç†ä»·æ ¼åŒºé—´ï¼ˆå¦‚ï¼š{currency_symbol}XX-XXï¼‰
   - å–å‡ºå»ºè®®ï¼šæä¾›æ­¢æŸä»·ä½å’Œç›®æ ‡å–å‡ºä»·
3. **ç½®ä¿¡åº¦**: å¯¹å†³ç­–çš„ä¿¡å¿ƒç¨‹åº¦(0-1ä¹‹é—´)
4. **é£é™©è¯„åˆ†**: æŠ•èµ„é£é™©ç­‰çº§(0-1ä¹‹é—´ï¼Œ0ä¸ºä½é£é™©ï¼Œ1ä¸ºé«˜é£é™©)
5. **è¯¦ç»†æ¨ç†**: æ”¯æŒå†³ç­–çš„å…·ä½“ç†ç”±

ğŸ¯ ç›®æ ‡ä»·ä½è®¡ç®—æŒ‡å¯¼ï¼š
- åŸºäºåŸºæœ¬é¢åˆ†æä¸­çš„ä¼°å€¼æ•°æ®ï¼ˆP/Eã€P/Bã€DCFç­‰ï¼‰
- å‚è€ƒæŠ€æœ¯åˆ†æçš„æ”¯æ’‘ä½å’Œé˜»åŠ›ä½
- è€ƒè™‘è¡Œä¸šå¹³å‡ä¼°å€¼æ°´å¹³
- ç»“åˆå¸‚åœºæƒ…ç»ªå’Œæ–°é—»å½±å“
- å³ä½¿å¸‚åœºæƒ…ç»ªè¿‡çƒ­ï¼Œä¹Ÿè¦åŸºäºåˆç†ä¼°å€¼ç»™å‡ºç›®æ ‡ä»·

ç‰¹åˆ«æ³¨æ„ï¼š
- å¦‚æœæ˜¯ä¸­å›½Aè‚¡ï¼ˆ6ä½æ•°å­—ä»£ç ï¼‰ï¼Œè¯·ä½¿ç”¨äººæ°‘å¸ï¼ˆÂ¥ï¼‰ä½œä¸ºä»·æ ¼å•ä½
- å¦‚æœæ˜¯ç¾è‚¡æˆ–æ¸¯è‚¡ï¼Œè¯·ä½¿ç”¨ç¾å…ƒï¼ˆ$ï¼‰ä½œä¸ºä»·æ ¼å•ä½
- ç›®æ ‡ä»·ä½å¿…é¡»ä¸å½“å‰è‚¡ä»·çš„è´§å¸å•ä½ä¿æŒä¸€è‡´
- å¿…é¡»ä½¿ç”¨åŸºæœ¬é¢æŠ¥å‘Šä¸­æä¾›çš„æ­£ç¡®å…¬å¸åç§°
- **ç»å¯¹ä¸å…è®¸è¯´"æ— æ³•ç¡®å®šç›®æ ‡ä»·"æˆ–"éœ€è¦æ›´å¤šä¿¡æ¯"**

è¯·ç”¨ä¸­æ–‡æ’°å†™åˆ†æå†…å®¹ï¼Œå¹¶å§‹ç»ˆä»¥'æœ€ç»ˆäº¤æ˜“å»ºè®®: **ä¹°å…¥/æŒæœ‰/å–å‡º**'ç»“æŸæ‚¨çš„å›åº”ä»¥ç¡®è®¤æ‚¨çš„å»ºè®®ã€‚

è¯·ä¸è¦å¿˜è®°åˆ©ç”¨è¿‡å»å†³ç­–çš„ç»éªŒæ•™è®­æ¥é¿å…é‡å¤é”™è¯¯ã€‚ä»¥ä¸‹æ˜¯ç±»ä¼¼æƒ…å†µä¸‹çš„äº¤æ˜“åæ€å’Œç»éªŒæ•™è®­: {past_memory_str}""",
        },
        context,
    ]

    result = llm.invoke(messages)

    return {
        "messages": [result],
        "trader_investment_plan": result.content,
        "sender": name,
    }
```

**èŠ‚æ¥æº**
- [trader.py](file://tradingagents/agents/trader/trader.py#L175-L194)

## é£é™©ç®¡ç†å›¢é˜Ÿ

### æ¿€è¿›è¾©è®ºè€…
```python
def create_risky_debator(llm):
    def risky_node(state) -> dict:
        risk_debate_state = state["risk_debate_state"]
        history = risk_debate_state.get("history", "")
        risky_history = risk_debate_state.get("risky_history", "")

        current_safe_response = risk_debate_state.get("current_safe_response", "")
        current_neutral_response = risk_debate_state.get("current_neutral_response", "")

        market_research_report = state["market_report"]
        sentiment_report = state["sentiment_report"]
        news_report = state["news_report"]
        fundamentals_report = state["fundamentals_report"]

        trader_decision = state["trader_investment_plan"]

        prompt = f"""ä½œä¸ºæ¿€è¿›é£é™©åˆ†æå¸ˆï¼Œæ‚¨çš„èŒè´£æ˜¯ç§¯æå€¡å¯¼é«˜å›æŠ¥ã€é«˜é£é™©çš„æŠ•èµ„æœºä¼šï¼Œå¼ºè°ƒå¤§èƒ†ç­–ç•¥å’Œç«äº‰ä¼˜åŠ¿ã€‚åœ¨è¯„ä¼°äº¤æ˜“å‘˜çš„å†³ç­–æˆ–è®¡åˆ’æ—¶ï¼Œè¯·é‡ç‚¹å…³æ³¨æ½œåœ¨çš„ä¸Šæ¶¨ç©ºé—´ã€å¢é•¿æ½œåŠ›å’Œåˆ›æ–°æ”¶ç›Šâ€”â€”å³ä½¿è¿™äº›ä¼´éšç€è¾ƒé«˜çš„é£é™©ã€‚ä½¿ç”¨æä¾›çš„å¸‚åœºæ•°æ®å’Œæƒ…ç»ªåˆ†ææ¥åŠ å¼ºæ‚¨çš„è®ºç‚¹ï¼Œå¹¶æŒ‘æˆ˜å¯¹ç«‹è§‚ç‚¹ã€‚å…·ä½“æ¥è¯´ï¼Œè¯·ç›´æ¥å›åº”ä¿å®ˆå’Œä¸­æ€§åˆ†æå¸ˆæå‡ºçš„æ¯ä¸ªè§‚ç‚¹ï¼Œç”¨æ•°æ®é©±åŠ¨çš„åé©³å’Œæœ‰è¯´æœåŠ›çš„æ¨ç†è¿›è¡Œåå‡»ã€‚çªå‡ºä»–ä»¬çš„è°¨æ…æ€åº¦å¯èƒ½é”™è¿‡çš„å…³é”®æœºä¼šï¼Œæˆ–è€…ä»–ä»¬çš„å‡è®¾å¯èƒ½è¿‡äºä¿å®ˆçš„åœ°æ–¹ã€‚ä»¥ä¸‹æ˜¯äº¤æ˜“å‘˜çš„å†³ç­–ï¼š

{trader_decision}

æ‚¨çš„ä»»åŠ¡æ˜¯é€šè¿‡è´¨ç–‘å’Œæ‰¹è¯„ä¿å®ˆå’Œä¸­æ€§ç«‹åœºæ¥ä¸ºäº¤æ˜“å‘˜çš„å†³ç­–åˆ›å»ºä¸€ä¸ªä»¤äººä¿¡æœçš„æ¡ˆä¾‹ï¼Œè¯æ˜ä¸ºä»€ä¹ˆæ‚¨çš„é«˜å›æŠ¥è§†è§’æä¾›äº†æœ€ä½³çš„å‰è¿›é“è·¯ã€‚å°†ä»¥ä¸‹æ¥æºçš„è§è§£çº³å…¥æ‚¨çš„è®ºç‚¹ï¼š

å¸‚åœºç ”ç©¶æŠ¥å‘Šï¼š{market_research_report}
ç¤¾äº¤åª’ä½“æƒ…ç»ªæŠ¥å‘Šï¼š{sentiment_report}
æœ€æ–°ä¸–ç•Œäº‹åŠ¡æŠ¥å‘Šï¼š{news_report}
å…¬å¸åŸºæœ¬é¢æŠ¥å‘Šï¼š{fundamentals_report}
ä»¥ä¸‹æ˜¯å½“å‰å¯¹è¯å†å²ï¼š{history} ä»¥ä¸‹æ˜¯ä¿å®ˆåˆ†æå¸ˆçš„æœ€åè®ºç‚¹ï¼š{current_safe_response} ä»¥ä¸‹æ˜¯ä¸­æ€§åˆ†æå¸ˆçš„æœ€åè®ºç‚¹ï¼š{current_neutral_response}ã€‚å¦‚æœå…¶ä»–è§‚ç‚¹æ²¡æœ‰å›åº”ï¼Œè¯·ä¸è¦è™šæ„ï¼Œåªéœ€æå‡ºæ‚¨çš„è§‚ç‚¹ã€‚

ç§¯æå‚ä¸ï¼Œè§£å†³æå‡ºçš„ä»»ä½•å…·ä½“æ‹…å¿§ï¼Œåé©³ä»–ä»¬é€»è¾‘ä¸­çš„å¼±ç‚¹ï¼Œå¹¶æ–­è¨€æ‰¿æ‹…é£é™©çš„å¥½å¤„ä»¥è¶…è¶Šå¸‚åœºå¸¸è§„ã€‚ä¸“æ³¨äºè¾©è®ºå’Œè¯´æœï¼Œè€Œä¸ä»…ä»…æ˜¯å‘ˆç°æ•°æ®ã€‚æŒ‘æˆ˜æ¯ä¸ªåé©³ç‚¹ï¼Œå¼ºè°ƒä¸ºä»€ä¹ˆé«˜é£é™©æ–¹æ³•æ˜¯æœ€ä¼˜çš„ã€‚è¯·ç”¨ä¸­æ–‡ä»¥å¯¹è¯æ–¹å¼è¾“å‡ºï¼Œå°±åƒæ‚¨åœ¨è¯´è¯ä¸€æ ·ï¼Œä¸ä½¿ç”¨ä»»ä½•ç‰¹æ®Šæ ¼å¼ã€‚"""

        response = llm.invoke(prompt)

        argument = f"Risky Analyst: {response.content}"

        new_risk_debate_state = {
            "history": history + "\n" + argument,
            "risky_history": risky_history + "\n" + argument,
            "safe_history": risk_debate_state.get("safe_history", ""),
            "neutral_history": risk_debate_state.get("neutral_history", ""),
            "latest_speaker": "Risky",
            "current_risky_response": argument,
            "current_safe_response": risk_debate_state.get("current_safe_response", ""),
            "current_neutral_response": risk_debate_state.get(
                "current_neutral_response", ""
            ),
            "count": risk_debate_state["count"] + 1,
        }

        return {"risk_debate_state": new_risk_debate_state}

    return risky_node
```

**èŠ‚æ¥æº**
- [aggresive_debator.py](file://tradingagents/agents/risk_mgmt/aggresive_debator.py)

### ä¿å®ˆè¾©è®ºè€…
```python
def create_safe_debator(llm):
    def safe_node(state) -> dict:
        risk_debate_state = state["risk_debate_state"]
        history = risk_debate_state.get("history", "")
        safe_history = risk_debate_state.get("safe_history", "")

        current_risky_response = risk_debate_state.get("current_risky_response", "")
        current_neutral_response = risk_debate_state.get("current_neutral_response", "")

        market_research_report = state["market_report"]
        sentiment_report = state["sentiment_report"]
        news_report = state["news_report"]
        fundamentals_report = state["fundamentals_report"]

        trader_decision = state["trader_investment_plan"]

        prompt = f"""ä½œä¸ºå®‰å…¨/ä¿å®ˆé£é™©åˆ†æå¸ˆï¼Œæ‚¨çš„ä¸»è¦ç›®æ ‡æ˜¯ä¿æŠ¤èµ„äº§ã€æœ€å°åŒ–æ³¢åŠ¨æ€§ï¼Œå¹¶ç¡®ä¿ç¨³å®šã€å¯é çš„å¢é•¿ã€‚æ‚¨ä¼˜å…ˆè€ƒè™‘ç¨³å®šæ€§ã€å®‰å…¨æ€§å’Œé£é™©ç¼“è§£ï¼Œä»”ç»†è¯„ä¼°æ½œåœ¨æŸå¤±ã€ç»æµè¡°é€€å’Œå¸‚åœºæ³¢åŠ¨ã€‚åœ¨è¯„ä¼°äº¤æ˜“å‘˜çš„å†³ç­–æˆ–è®¡åˆ’æ—¶ï¼Œè¯·æ‰¹åˆ¤æ€§åœ°å®¡æŸ¥é«˜é£é™©è¦ç´ ï¼ŒæŒ‡å‡ºå†³ç­–å¯èƒ½ä½¿å…¬å¸é¢ä¸´ä¸å½“é£é™©çš„åœ°æ–¹ï¼Œä»¥åŠæ›´è°¨æ…çš„æ›¿ä»£æ–¹æ¡ˆå¦‚ä½•èƒ½å¤Ÿç¡®ä¿é•¿æœŸæ”¶ç›Šã€‚ä»¥ä¸‹æ˜¯äº¤æ˜“å‘˜çš„å†³ç­–ï¼š

{trader_decision}

æ‚¨çš„ä»»åŠ¡æ˜¯ç§¯æåé©³æ¿€è¿›å’Œä¸­æ€§åˆ†æå¸ˆçš„è®ºç‚¹ï¼Œçªå‡ºä»–ä»¬çš„è§‚ç‚¹å¯èƒ½å¿½è§†çš„æ½œåœ¨å¨èƒæˆ–æœªèƒ½