
# 分析师团队

<cite>
**本文档引用的文件**
- [market_analyst.py](file://tradingagents/agents/analysts/market_analyst.py)
- [fundamentals_analyst.py](file://tradingagents/agents/analysts/fundamentals_analyst.py)
- [news_analyst.py](file://tradingagents/agents/analysts/news_analyst.py)
- [social_media_analyst.py](file://tradingagents/agents/analysts/social_media_analyst.py)
- [china_market_analyst.py](file://tradingagents/agents/analysts/china_market_analyst.py)
- [agent_states.py](file://tradingagents/agents/utils/agent_states.py)
- [conditional_logic.py](file://tradingagents/graph/conditional_logic.py)
</cite>

## 目录
1. [简介](#简介)
2. [核心分析师职责与实现机制](#核心分析师职责与实现机制)
3. [中国特定市场分析师的适配优化](#中国特定市场分析师的适配优化)
4. [多分析师协作流程与状态管理](#多分析师协作流程与状态管理)
5. [实际分析流程案例](#实际分析流程案例)
6. [结论](#结论)

## 简介
本项目构建了一个由多个专业智能体组成的分析师团队，旨在对股票进行全面、多维度的分析。该团队由市场分析师、基本面分析师、新闻分析师、社交媒体分析师以及专门针对中国市场的中国特定市场分析师组成。每个智能体都扮演着独特的角色，通过调用外部API获取数据，并利用大型语言模型（LLM）进行深度分析。这些智能体在TradingGraph中协同工作，共享信息，最终形成一份综合性的投资分析报告。本报告将深入探讨每个分析师的职责、实现机制、数据源、处理逻辑以及它们之间的协作方式。

## 核心分析师职责与实现机制

### 市场分析师
市场分析师负责对股票的技术面进行深入分析，其核心职责是评估价格趋势、成交量、技术指标和市场情绪。该智能体根据股票代码自动判断目标市场（A股或美股/港股），并相应地选择数据源和分析策略。

- **输入数据源**：对于中国A股，主要使用`Tushare`数据接口（通过`get_china_stock_data`工具）；对于美股和港股，则使用`FinnHub`和`Yahoo Finance`（通过`get_YFin_data_online`工具）。
- **处理逻辑**：智能体首先检查股票代码格式（6位数字为A股）。在在线模式下，它会创建一个ReAct Agent，该Agent会主动调用相应的数据获取工具。系统提示词强制要求模型必须调用工具并基于真实数据生成报告，报告长度不少于800字。
- **调用的LLM模型**：可配置，支持多种LLM，如DeepSeek、通义千问等。
- **输出格式**：生成包含“股票基本信息”、“技术指标分析”、“价格趋势分析”、“成交量分析”和“投资建议”等部分的详细中文报告，并将其存储在`AgentState`的`market_report`字段中。

**Section sources**
- [market_analyst.py](file://tradingagents/agents/analysts/market_analyst.py#L7-L409)

### 基本面分析师
基本面分析师专注于评估公司的内在价值，通过分析财务报表、盈利能力、成长性和估值水平来判断股票是否被高估或低估。

- **输入数据源**：对于中国A股，使用`Tushare`获取财务数据（通过`get_china_fundamentals`工具）；对于其他市场，则可能使用`OpenAI`新闻API或`FinnHub`等工具。
- **处理逻辑**：该智能体同样区分A股和非A股。对于A股，系统提示词极为严格，强制要求模型立即调用`get_china_stock_data`和`get_china_fundamentals`两个工具，禁止任何假设或编造数据。它还包含针对“阿里百炼”（DashScope）等特定LLM的修复逻辑，如果模型未调用工具，则会强制执行工具调用以确保分析的可靠性。
- **调用的LLM模型**：可配置，但其内部逻辑特别处理了`DashScope`类模型的工具调用问题。
- **输出格式**：生成包含“公司基本信息”、“财务状况分析”、“盈利能力分析”、“成长性分析”、“估值分析”和“投资建议”的详细中文报告，并将其存储在`AgentState`的`fundamentals_report`字段中。

**Section sources**
- [fundamentals_analyst.py](file://tradingagents/agents/analysts/fundamentals_analyst.py#L7-L542)

### 新闻分析师
新闻分析师负责监控和分析影响股价的最新财经新闻和重大事件，评估其对市场情绪和股价的潜在影响。

- **输入数据源**：在在线模式下，优先使用实时新闻API（`get_realtime_stock_news`），并结合`Google News`和`OpenAI`新闻API（`get_global_news_openai`）。
- **处理逻辑**：智能体被设计为优先分析15-30分钟内的最新新闻，评估其紧急程度和市场影响。系统提示词明确要求必须提供“价格影响分析”，包括短期影响、波动幅度和价格调整建议，不允许回复“无法评估”。
- **调用的LLM模型**：可配置。
- **输出格式**：生成详细的中文分析报告，重点包含新闻的时效性、可信度、市场影响程度和价格影响评估，并将报告存储在`AgentState`的`news_report`字段中。

**Section sources**
- [news_analyst.py](file://tradingagents/agents/analysts/news_analyst.py#L1-L104)

### 社交媒体分析师
社交媒体分析师专注于分析中国投资者在社交媒体和财经社区中的情绪和讨论，以捕捉散户投资者的情绪变化。

- **输入数据源**：在在线模式下，使用`get_stock_news_openai`；在离线模式下，优先使用`get_chinese_social_sentiment`（分析雪球、东方财富股吧等平台），并回退到`get_reddit_stock_info`。
- **处理逻辑**：该智能体特别关注中国本土平台，如雪球、东方财富、微博财经大V等。它被要求量化投资者情绪（如给出1-10分的情绪指数），并分析情绪变化对短期股价的影响。
- **调用的LLM模型**：可配置。
- **输出格式**：生成包含情绪指数评分、预期价格波动幅度和交易时机建议的中文报告，并将其存储在`AgentState`的`sentiment_report`字段中。

**Section sources**
- [social_media_analyst.py](file://tradingagents/agents/analysts/social_media_analyst.py#L1-L99)

## 中国特定市场分析师的适配优化
中国特定市场分析师是专门为A股市场设计的专家，它深刻理解中国资本市场的独特规则和投资者行为。

- **适配优化**：
    1.  **市场特性理解**：该智能体的系统提示词明确要求其考虑A股的“涨跌停制度”、“T+1交易”、“融资融券”、“ST股票风险”、“科创板/创业板”以及“国企改革”等中国特色因素。
    2.  **数据源优先**：其分析工具链优先使用`Tushare`和`通达信`数据接口（`get_china